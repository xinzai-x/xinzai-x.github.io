<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>星仔人生录</title>
  
  <subtitle>珍惜当下 不负此生</subtitle>
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2024-08-15T02:41:49.837Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>星仔</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>7.实时时钟(RTC)</title>
    <link href="http://example.com/post/e8bc8f26.html"/>
    <id>http://example.com/post/e8bc8f26.html</id>
    <published>2024-08-14T13:12:02.000Z</published>
    <updated>2024-08-15T02:41:49.837Z</updated>
    
    <content type="html"><![CDATA[<h1 id="理论"><a href="#理论" class="headerlink" title="理论"></a><center>理论</center></h1><p>使用时钟晶振：32.768KHz(2^{15}^)</p><h1 id="代码编写"><a href="#代码编写" class="headerlink" title="代码编写"></a><center>代码编写</center></h1><p>OLED显示实时时间，串口打印</p><h2 id="晶体、RTC配置"><a href="#晶体、RTC配置" class="headerlink" title="晶体、RTC配置"></a><center>晶体、RTC配置</center></h2><h3 id="晶体配置"><a href="#晶体配置" class="headerlink" title="晶体配置"></a>晶体配置</h3><p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408151041859.png" alt="晶体配置"></p><hr><p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408151041494.png" alt="配置时钟"></p><h3 id="RTC配置"><a href="#RTC配置" class="headerlink" title="RTC配置"></a>RTC配置</h3><p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408151041569.png" alt="RTC配置"></p><p>串口配置参考：<a href="https://blog.csdn.net/qq_65047384/article/details/140912225">链接</a></p><h2 id="Cube-IDE代码"><a href="#Cube-IDE代码" class="headerlink" title="Cube IDE代码"></a><center>Cube IDE代码</center></h2><p>mian.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* USER CODE BEGIN Includes */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;string.h&quot;</span><span class="comment">//27行</span></span></span><br><span class="line"><span class="comment">/* USER CODE END Includes */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* USER CODE BEGIN PV */</span></span><br><span class="line">RTC_TimeTypeDef RTC_Time;<span class="comment">//48行</span></span><br><span class="line">RTC_DateTypeDef RTC_Date;</span><br><span class="line"><span class="type">uint8_t</span> RTC_Buff[<span class="number">200</span>];</span><br><span class="line"><span class="type">uint8_t</span> RTC_Buff1[<span class="number">200</span>];</span><br><span class="line"><span class="comment">/* USER CODE END PV */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//while里，108行</span></span><br><span class="line"><span class="comment">/* 参数1：指向 RTC_HandleTypeDef 结构的指针，该结构包含RTC 的配置信息</span></span><br><span class="line"><span class="comment">* 参数2：指向时间结构的指针，参数3：RTC_FORMAT_BIN:二进制数据格式，RTC_FORMAT_BCD:十六进制数据格式</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">HAL_RTC_GetTime(&amp;hrtc, &amp;RTC_Time, RTC_FORMAT_BIN);<span class="comment">//获取时分秒</span></span><br><span class="line"><span class="built_in">sprintf</span>(RTC_Buff,<span class="string">&quot;Time:%d:%d:%d\r\n&quot;</span>, RTC_Time.Hours, RTC_Time.Minutes, RTC_Time.Seconds);</span><br><span class="line">HAL_UART_Transmit(&amp;huart1, RTC_Buff, <span class="built_in">strlen</span>(RTC_Buff), <span class="number">100</span>);</span><br><span class="line">HAL_Delay(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">HAL_RTC_GetDate(&amp;hrtc, &amp;RTC_Date, RTC_FORMAT_BIN);<span class="comment">//获取年月日星期</span></span><br><span class="line"><span class="built_in">sprintf</span>(RTC_Buff1,<span class="string">&quot;Date:%d:%d:%d,WeekDay:%d\r\n&quot;</span>, RTC_Date.Year, RTC_Date.Month, RTC_Date.Date, RTC_Date.WeekDay);</span><br><span class="line">HAL_UART_Transmit(&amp;huart1, RTC_Buff1, <span class="built_in">strlen</span>(RTC_Buff1), <span class="number">100</span>);</span><br><span class="line">HAL_Delay(<span class="number">1000</span>);</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;理论&quot;&gt;&lt;a href=&quot;#理论&quot; class=&quot;headerlink&quot; title=&quot;理论&quot;&gt;&lt;/a&gt;&lt;center&gt;理论&lt;/center&gt;&lt;/h1&gt;&lt;p&gt;使用时钟晶振：32.768KHz(2^{15}^)&lt;/p&gt;
&lt;h1 id=&quot;代码编写&quot;&gt;&lt;a href=&quot;</summary>
      
    
    
    
    <category term="32单片机" scheme="http://example.com/categories/32%E5%8D%95%E7%89%87%E6%9C%BA/"/>
    
    
    <category term="32单片机" scheme="http://example.com/tags/32%E5%8D%95%E7%89%87%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>6.IIC通信</title>
    <link href="http://example.com/post/f5fba2c3.html"/>
    <id>http://example.com/post/f5fba2c3.html</id>
    <published>2024-08-13T09:53:28.000Z</published>
    <updated>2024-08-15T01:46:13.045Z</updated>
    
    <content type="html"><![CDATA[<h1 id="理论"><a href="#理论" class="headerlink" title="理论"></a><center>理论</center></h1><p>参考51单片机IIC理论：<a href="https://d3iiz.top/post/f5fba2c3.html">链接</a></p><p>在起始信号后必须发送一个7位从机地址 + 1位方向位，用“0”表示主机发送数据，“1”表示主机接收数据</p><h1 id="代码编写"><a href="#代码编写" class="headerlink" title="代码编写"></a><center>代码编写</center></h1><h2 id="IIC三个模式配置"><a href="#IIC三个模式配置" class="headerlink" title="IIC三个模式配置"></a><center>IIC三个模式配置</center></h2><h3 id="IIC-阻塞模式-配置"><a href="#IIC-阻塞模式-配置" class="headerlink" title="IIC(阻塞模式)配置"></a>IIC(阻塞模式)配置</h3><p>主要方式</p><p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408142114842.png" alt="IIC(阻塞模式)配置"></p><h3 id="IIC-中断模式-配置"><a href="#IIC-中断模式-配置" class="headerlink" title="IIC(中断模式)配置"></a>IIC(中断模式)配置</h3><p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408142114758.png" alt="IIC(中断模式)配置"></p><h3 id="IIC-DMA模式-配置"><a href="#IIC-DMA模式-配置" class="headerlink" title="IIC(DMA模式)配置"></a>IIC(DMA模式)配置</h3><p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408142113463.png" alt="IIC(DMA模式)配置"></p><h2 id="阻塞模式"><a href="#阻塞模式" class="headerlink" title="阻塞模式"></a><center>阻塞模式</center></h2><p>mian.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Reset of all peripherals, Initializes the Flash interface and the Systick. */</span></span><br><span class="line">HAL_Init();<span class="comment">//75行</span></span><br><span class="line">MX_I2C1_Init();</span><br><span class="line"><span class="comment">/* USER CODE BEGIN Init */</span></span><br><span class="line">OLED_Init();<span class="comment">//初始化OLED</span></span><br><span class="line">OLED_Clear();</span><br><span class="line">OLED_ShowCHinese(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);<span class="comment">//�?</span></span><br><span class="line">OLED_ShowCHinese(<span class="number">18</span>,<span class="number">0</span>,<span class="number">1</span>);<span class="comment">//�?</span></span><br><span class="line">OLED_ShowCHinese(<span class="number">36</span>,<span class="number">0</span>,<span class="number">2</span>);<span class="comment">//�?</span></span><br><span class="line">OLED_ShowCHinese(<span class="number">54</span>,<span class="number">0</span>,<span class="number">3</span>);<span class="comment">//�?</span></span><br><span class="line">OLED_ShowCHinese(<span class="number">72</span>,<span class="number">0</span>,<span class="number">4</span>);<span class="comment">//�?</span></span><br><span class="line">OLED_ShowCHinese(<span class="number">90</span>,<span class="number">0</span>,<span class="number">5</span>);<span class="comment">//�?</span></span><br><span class="line">OLED_ShowCHinese(<span class="number">108</span>,<span class="number">0</span>,<span class="number">6</span>);<span class="comment">//�?</span></span><br><span class="line">OLED_ShowCHinese(<span class="number">0</span>,<span class="number">2</span>,<span class="number">6</span>);<span class="comment">//�?</span></span><br><span class="line"><span class="comment">/* USER CODE END Init */</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>olde.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**********************************************</span></span><br><span class="line"><span class="comment">// IIC Write Command命令</span></span><br><span class="line"><span class="comment">**********************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Write_IIC_Command</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> IIC_Command)</span><span class="comment">//10行</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//   IIC_Start();</span></span><br><span class="line"><span class="comment">//   IIC_Write_Byte(0x78);            //Slave address,SA0=0</span></span><br><span class="line"><span class="comment">//   IIC_Write_Byte(0x00);//write command</span></span><br><span class="line"><span class="comment">//   IIC_Write_Byte(IIC_Command);</span></span><br><span class="line"><span class="comment">//   IIC_Stop();</span></span><br><span class="line"> <span class="type">uint8_t</span> IIC_Send_Cmd[]=&#123;<span class="number">0x00</span>,IIC_Command&#125;;<span class="comment">//将两个数据放进数组</span></span><br><span class="line"> <span class="comment">/* 参数1：指向 I2C_HandleTypeDef 结构的指针，该结构包含指定 I2C 的配置信息</span></span><br><span class="line"><span class="comment">  * 参数2：设备地址，参数3：</span></span><br><span class="line"><span class="comment">  * 参数4：要发送的数据量，参数5：超时持续时间</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> HAL_I2C_Master_Transmit(&amp;hi2c1, <span class="number">0x78</span>, IIC_Send_Cmd, <span class="number">2</span>, <span class="number">100</span>);<span class="comment">//调用库函数阻塞发送IIC</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**********************************************</span></span><br><span class="line"><span class="comment">// IIC Write Data数据</span></span><br><span class="line"><span class="comment">**********************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Write_IIC_Data</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> IIC_Data)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//   IIC_Start();</span></span><br><span class="line"><span class="comment">//   IIC_Write_Byte(0x78);//D/C#=0; R/W#=0</span></span><br><span class="line"><span class="comment">//   IIC_Write_Byte(0x40);//write data</span></span><br><span class="line"><span class="comment">//   IIC_Write_Byte(IIC_Data);</span></span><br><span class="line"><span class="comment">//   IIC_Stop();</span></span><br><span class="line">   <span class="type">uint8_t</span> IIC_Send_Data[]=&#123;<span class="number">0x40</span>,IIC_Data&#125;;<span class="comment">//将两个数据放进数组</span></span><br><span class="line">   <span class="comment">/* 参数1：指向 I2C_HandleTypeDef 结构的指针，该结构包含指定 I2C 的配置信息</span></span><br><span class="line"><span class="comment">* 参数2：设备地址，参数3：</span></span><br><span class="line"><span class="comment">* 参数4：要发送的数据量，参数5：超时持续时间</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">   HAL_I2C_Master_Transmit(&amp;hi2c1, <span class="number">0x78</span>, IIC_Send_Data, <span class="number">2</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="中断模式"><a href="#中断模式" class="headerlink" title="中断模式"></a><center>中断模式</center></h2><p>mian.c与阻塞相同</p><p>oled.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**********************************************</span></span><br><span class="line"><span class="comment">// IIC Write Command命令</span></span><br><span class="line"><span class="comment">**********************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Write_IIC_Command</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> IIC_Command)</span><span class="comment">//10行</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//   IIC_Start();</span></span><br><span class="line"><span class="comment">//   IIC_Write_Byte(0x78);            //Slave address,SA0=0</span></span><br><span class="line"><span class="comment">//   IIC_Write_Byte(0x00);//write command</span></span><br><span class="line"><span class="comment">//   IIC_Write_Byte(IIC_Command);</span></span><br><span class="line"><span class="comment">//   IIC_Stop();</span></span><br><span class="line"> <span class="type">uint8_t</span> IIC_Send_Cmd[]=&#123;<span class="number">0x00</span>,IIC_Command&#125;;<span class="comment">//将两个数据放进数组</span></span><br><span class="line"> <span class="comment">/* 参数1：指向 I2C_HandleTypeDef 结构的指针，该结构包含指定 I2C 的配置信息</span></span><br><span class="line"><span class="comment">  * 参数2：设备地址，参数3：</span></span><br><span class="line"><span class="comment">  * 参数4：要发送的数据量</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> HAL_I2C_Master_Transmit_IT(&amp;hi2c1, <span class="number">0x78</span>, IIC_Send_Cmd, <span class="number">2</span>);</span><br><span class="line"> HAL_Delay(<span class="number">1</span>);<span class="comment">//如果不延时发太快不显示,但OLED显示太慢</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**********************************************</span></span><br><span class="line"><span class="comment">// IIC Write Data数据</span></span><br><span class="line"><span class="comment">**********************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Write_IIC_Data</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> IIC_Data)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//   IIC_Start();</span></span><br><span class="line"><span class="comment">//   IIC_Write_Byte(0x78);//D/C#=0; R/W#=0</span></span><br><span class="line"><span class="comment">//   IIC_Write_Byte(0x40);//write data</span></span><br><span class="line"><span class="comment">//   IIC_Write_Byte(IIC_Data);</span></span><br><span class="line"><span class="comment">//   IIC_Stop();</span></span><br><span class="line">   <span class="type">uint8_t</span> IIC_Send_Data[]=&#123;<span class="number">0x40</span>,IIC_Data&#125;;<span class="comment">//将两个数据放进数组</span></span><br><span class="line">   <span class="comment">/* 参数1：指向 I2C_HandleTypeDef 结构的指针，该结构包含指定 I2C 的配置信息</span></span><br><span class="line"><span class="comment">* 参数2：设备地址，参数3：</span></span><br><span class="line"><span class="comment">* 参数4：要发送的数据量</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">   HAL_I2C_Master_Transmit_IT(&amp;hi2c1, <span class="number">0x78</span>, IIC_Send_Data, <span class="number">2</span>);</span><br><span class="line">   HAL_Delay(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;理论&quot;&gt;&lt;a href=&quot;#理论&quot; class=&quot;headerlink&quot; title=&quot;理论&quot;&gt;&lt;/a&gt;&lt;center&gt;理论&lt;/center&gt;&lt;/h1&gt;&lt;p&gt;参考51单片机IIC理论：&lt;a href=&quot;https://d3iiz.top/post/f5fba2c3</summary>
      
    
    
    
    <category term="32单片机" scheme="http://example.com/categories/32%E5%8D%95%E7%89%87%E6%9C%BA/"/>
    
    
    <category term="32单片机" scheme="http://example.com/tags/32%E5%8D%95%E7%89%87%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>office无法初始化VisualBasic</title>
    <link href="http://example.com/post/6928cd3f.html"/>
    <id>http://example.com/post/6928cd3f.html</id>
    <published>2024-08-12T15:37:39.000Z</published>
    <updated>2024-08-13T09:55:24.530Z</updated>
    
    <content type="html"><![CDATA[<p>1.打开word，将 无法初始化visual basic 的弹出框先关掉</p><p>2.点击左上角的 <code>文件</code></p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408122338415.png" alt="点击文件" style="zoom:50%;"><p>3.点击帮助栏目下的 <code>选项</code>，然后点击 <code>加载项</code></p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408122338308.png" alt="进入选项" style="zoom:50%;"><hr><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408122339744.png" alt="进入设置" style="zoom:50%;"><p>4.在弹出的com加载项中将所有带√的选项都去掉(此处不是删除，只是将<code>√去掉</code>)，最后点击<code>确定</code>，重新打开文件</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408122339947.png" alt="取消" style="zoom:50%;"><p>5.大功告成</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;1.打开word，将 无法初始化visual basic 的弹出框先关掉&lt;/p&gt;
&lt;p&gt;2.点击左上角的 &lt;code&gt;文件&lt;/code&gt;&lt;/p&gt;
&lt;img src=&quot;https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408122</summary>
      
    
    
    
    <category term="Windows使用技巧" scheme="http://example.com/categories/Windows%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/"/>
    
    
    <category term="office无法初始化VisualBasic" scheme="http://example.com/tags/office%E6%97%A0%E6%B3%95%E5%88%9D%E5%A7%8B%E5%8C%96VisualBasic/"/>
    
  </entry>
  
  <entry>
    <title>5.ADC(模拟信号转数字信号)</title>
    <link href="http://example.com/post/bfd038f5.html"/>
    <id>http://example.com/post/bfd038f5.html</id>
    <published>2024-08-10T06:45:10.000Z</published>
    <updated>2024-08-13T09:25:18.240Z</updated>
    
    <content type="html"><![CDATA[<h1 id="理论"><a href="#理论" class="headerlink" title="理论"></a><center>理论</center></h1><p>3个ADC控制器</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408121609746.png" alt="3个ADC控制器" style="zoom: 67%;"><p>转换：单次转换模式、 连续转换模式</p><p>转换时间 &#x3D; 采样时间 + 12.5周期</p><p>&ensp;&ensp;&ensp;&ensp;当ADCCLK(时钟) &#x3D; 14MHz，采样时间为1.5周期，TcoNv(转换时间) &#x3D; 1.5 + 12.5 &#x3D; 14 周期 &#x3D; 1us</p><p>采样精度：12位&#x2F;16位(2^12^ &#x3D; 4096)</p><p>实际电压值 &#x3D; <code>(通道采集的ADC值 * 3.3) / 4096</code></p><p>数据对齐：左对齐、右对齐</p><h1 id="代码编写"><a href="#代码编写" class="headerlink" title="代码编写"></a><center>代码编写</center></h1><p>电压采集</p><h2 id="ADC、串口一配置"><a href="#ADC、串口一配置" class="headerlink" title="ADC、串口一配置"></a><center>ADC、串口一配置</center></h2><h3 id="ADC-阻塞模式-配置"><a href="#ADC-阻塞模式-配置" class="headerlink" title="ADC(阻塞模式)配置"></a>ADC(阻塞模式)配置</h3><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408121609883.png" alt="配置ADC" style="zoom: 33%;"><hr><p>多个通道时，自动扫描会自动打开使能</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408121609749.png" alt="配置ADC" style="zoom:50%;"><hr><p>修改时钟分频：</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408121609690.png" alt="修改时钟配置" style="zoom:33%;"><p>配置串口一打印采集到的电压值，配置方法参考：<a href="https://d3iiz.top/post/2c4c3bc3.html">链接</a></p><h3 id="ADC-DMA模式-配置"><a href="#ADC-DMA模式-配置" class="headerlink" title="ADC(DMA模式)配置"></a>ADC(DMA模式)配置</h3><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408121608683.png" alt="ADC配置" style="zoom:50%;"><p>配置串口一打印采集到的电压值，配置方法参考：<a href="https://d3iiz.top/post/2c4c3bc3.html">链接</a></p><p>修改时钟分频（和上面相同）</p><p>配置DMA：</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408121610011.png" alt="配置DMA" style="zoom:33%;"><h3 id="ADC-中断模式-配置"><a href="#ADC-中断模式-配置" class="headerlink" title="ADC(中断模式)配置"></a>ADC(中断模式)配置</h3><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408121611895.png" alt="配置ADC" style="zoom: 50%;"><p>配置串口一打印采集到的电压值，配置方法参考：<a href="https://d3iiz.top/post/2c4c3bc3.html">链接</a></p><p>修改时钟分频（和上面相同）</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408121611274.png" alt="配置ADC中断" style="zoom: 33%;"><h2 id="阻塞模式"><a href="#阻塞模式" class="headerlink" title="阻塞模式"></a><center>阻塞模式</center></h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">HAL_ADCEx_Calibration_Start(&amp;hadc1);<span class="comment">//校准，adc.c,94行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//main.c</span></span><br><span class="line"><span class="comment">/* USER CODE BEGIN Includes */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span><span class="comment">//27行</span></span></span><br><span class="line"><span class="comment">/* USER CODE END Includes */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* USER CODE BEGIN PV */</span></span><br><span class="line"><span class="type">uint16_t</span> AD_Buf[<span class="number">4</span>];<span class="comment">//48行</span></span><br><span class="line"><span class="type">uint8_t</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="type">uint8_t</span> Send_Buf[<span class="number">50</span>];</span><br><span class="line"><span class="comment">/* USER CODE END PV */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//while里,103行</span></span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)<span class="comment">//4个通道一次采集采集一个通道for4</span></span><br><span class="line">&#123;</span><br><span class="line">HAL_ADC_Start(&amp;hadc1);<span class="comment">//手动使能开始转换</span></span><br><span class="line">HAL_ADC_PollForConversion(&amp;hadc1,<span class="number">10</span>);<span class="comment">//等待转换完成，等待时间10ms，超时结束</span></span><br><span class="line">AD_Buf[i] = HAL_ADC_GetValue(&amp;hadc1);<span class="comment">//获取转换后的值</span></span><br><span class="line"><span class="built_in">sprintf</span>(Send_Buf,<span class="string">&quot;Channel:%d:  V:%1.2f  Value:%d\n\r&quot;</span>, i+<span class="number">1</span>, (<span class="type">float</span>)(AD_Buf[i])*<span class="number">3.3f</span>/<span class="number">4096.0</span>, AD_Buf[i]);</span><br><span class="line">HAL_UART_Transmit(&amp;huart1,Send_Buf, <span class="built_in">strlen</span>(Send_Buf), <span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line">HAL_Delay(<span class="number">1000</span>);</span><br></pre></td></tr></table></figure><h2 id="DMA模式"><a href="#DMA模式" class="headerlink" title="DMA模式"></a><center>DMA模式</center></h2><p>DMA会触发中断</p><p>main.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* USER CODE BEGIN PV */</span></span><br><span class="line"><span class="type">uint16_t</span> AD_Buf[<span class="number">4</span>];<span class="comment">//49行</span></span><br><span class="line"><span class="comment">/* USER CODE END PV */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* USER CODE BEGIN 2 */</span></span><br><span class="line">HAL_ADCEx_Calibration_Start(&amp;hadc1);<span class="comment">//校准，96行</span></span><br><span class="line"><span class="comment">//参数1：ADC句柄,参数2：目标缓冲区地址,参数3：从 ADC 外设传输到存储器的数据长度(两个通道)</span></span><br><span class="line">HAL_ADC_Start_DMA(&amp;hadc1,(<span class="type">uint32_t</span> *)&amp;AD_Buf,<span class="number">2</span>);</span><br><span class="line"><span class="comment">/* USER CODE END 2 */</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;AD1= V:%1.2f  Value:%d\n\r&quot;</span>, AD_Buf[<span class="number">0</span>]*<span class="number">3.3</span>/<span class="number">4096.0</span>, AD_Buf[<span class="number">0</span>]);<span class="comment">//105行</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;AD2= V:%1.2f  Value:%d\n\r&quot;</span>, AD_Buf[<span class="number">1</span>]*<span class="number">3.3</span>/<span class="number">4096.0</span>, AD_Buf[<span class="number">1</span>]);<span class="comment">//106行</span></span><br><span class="line">HAL_Delay(<span class="number">1000</span>);</span><br></pre></td></tr></table></figure><h2 id="中断模式"><a href="#中断模式" class="headerlink" title="中断模式"></a><center>中断模式</center></h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* USER CODE BEGIN ADC1_Init 2 */</span></span><br><span class="line">HAL_ADCEx_Calibration_Start(&amp;hadc1);<span class="comment">//校准，adc.c,67行</span></span><br><span class="line">HAL_ADC_Start_IT(&amp;hadc1);<span class="comment">//开启中断模式，即开始采集</span></span><br><span class="line"><span class="comment">/* USER CODE END ADC1_Init 2 */</span></span><br><span class="line"></span><br><span class="line">main.c</span><br><span class="line"><span class="comment">/* USER CODE BEGIN PV */</span></span><br><span class="line"><span class="type">uint16_t</span> Send_Buf[<span class="number">20</span>];<span class="comment">//48行</span></span><br><span class="line"><span class="type">uint16_t</span> AD_Value;</span><br><span class="line"><span class="comment">/* USER CODE END PV */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//while,102行</span></span><br><span class="line"><span class="built_in">sprintf</span>(Send_Buf,<span class="string">&quot;V:%1.2f  Value:%d\n\r&quot;</span>,(<span class="type">float</span>)(AD_Value)*<span class="number">3.3f</span>/<span class="number">4096.0</span>,AD_Value);</span><br><span class="line">HAL_UART_Transmit(&amp;huart1,Send_Buf, <span class="built_in">strlen</span>(Send_Buf), <span class="number">10</span>);</span><br><span class="line">HAL_Delay(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* USER CODE BEGIN 4 */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">HAL_ADC_ConvCpltCallback</span><span class="params">(ADC_HandleTypeDef* hadc)</span><span class="comment">//159行</span></span><br><span class="line">&#123;</span><br><span class="line">AD_Value = HAL_ADC_GetValue(&amp;hadc1);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* USER CODE END 4 */</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;理论&quot;&gt;&lt;a href=&quot;#理论&quot; class=&quot;headerlink&quot; title=&quot;理论&quot;&gt;&lt;/a&gt;&lt;center&gt;理论&lt;/center&gt;&lt;/h1&gt;&lt;p&gt;3个ADC控制器&lt;/p&gt;
&lt;img src=&quot;https://cdn.d3iiz.top/gh/xinza</summary>
      
    
    
    
    <category term="32单片机" scheme="http://example.com/categories/32%E5%8D%95%E7%89%87%E6%9C%BA/"/>
    
    
    <category term="32单片机" scheme="http://example.com/tags/32%E5%8D%95%E7%89%87%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>4.定时器(TIMER)</title>
    <link href="http://example.com/post/f71d0ad2.html"/>
    <id>http://example.com/post/f71d0ad2.html</id>
    <published>2024-08-06T08:19:27.000Z</published>
    <updated>2024-08-10T09:02:58.300Z</updated>
    
    <content type="html"><![CDATA[<h1 id="理论"><a href="#理论" class="headerlink" title="理论"></a><center>理论</center></h1><p>预分频寄存器(TIMx_PSC)：由于时钟源为：72MHz，T &#x3D; 1&#x2F;f &#x3D; 1&#x2F;72MHz，由于不好计算周期时间，则需要分频，若分72则T &#x3D; 1&#x2F;1MHz &#x3D; 1us(1MHz &#x3D; 一百万秒)</p><p>计数方式：向上(递增到某个数触发中断)、向下(递减到某一个数触发中断)、中心计数(递增到某一个数触发中断，再递减到某一个数触发中断)</p><p>比较值(参考：<a href="https://blog.csdn.net/qq_36553707/article/details/109527645">链接</a>)：</p><p>&ensp;&ensp;&ensp;&ensp;PWM1模式：若计数值小于有效值则高电平，计数值大于有效值则低电平，可以控制比较值来调节占空比</p><p>&ensp;&ensp;&ensp;&ensp;PWM2模式：与PWM1模式相反，计数值小于有效值则低电平，大于有效值则高电平</p><p>复用：Pin脚本身除了支持普通GPIO功能之外，还支持别的功能(使用别的功能就叫复用)</p><p>重映射：Pin脚本身不支持这些功能，配置重映射寄存器，使其具备别的功能</p><h2 id="定时器分类"><a href="#定时器分类" class="headerlink" title="定时器分类"></a><center>定时器分类</center></h2><p>型号：STM32F103ZET6</p><p>基本定时器：TIM6、TIM7</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408092327771.png" alt="基本定时器功能" style="zoom: 50%;"><p>通用定时器：TIM2~TIM5</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408092327567.png" alt="通用定时器功能" style="zoom:50%;"><p>高级定时器：TIM1、TIM8</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408092327762.png" alt="高级定时器功能" style="zoom:50%;"><h1 id="代码编写"><a href="#代码编写" class="headerlink" title="代码编写"></a><center>代码编写</center></h1><p>定时器中断实验：LED灯一秒闪烁一次、LED灯两秒闪烁一次、计算单片机运行时间、串口5秒返回单片机运行时间</p><p>PWM信号输出：呼吸灯、电机(由慢到快)、舵机</p><p>输入捕获：检测信号脉冲宽度(舵机脉冲宽度)</p><h2 id="LED灯、UART、定时器、PWM配置"><a href="#LED灯、UART、定时器、PWM配置" class="headerlink" title="LED灯、UART、定时器、PWM配置"></a><center>LED灯、UART、定时器、PWM配置</center></h2><p>LED灯配置请看：<a href="https://d3iiz.top/post/adb202b7.html">链接</a></p><p>串口配置请看：<a href="https://d3iiz.top/post/2c4c3bc3.html">链接</a></p><h3 id="配置定时器："><a href="#配置定时器：" class="headerlink" title="配置定时器："></a>配置定时器：</h3><p>72&#x2F;7200 &#x3D; 0.01，T &#x3D; 1&#x2F;f &#x3D; 1&#x2F;0.01MHz &#x3D; 100us，计数10000，触发中断，100us * 10000 &#x3D; 1s，1s &#x3D; 1000000us，但单片机都是以0开始，所以分频值以及计数值都 -1</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408092327709.png" alt="定时器配置" style="zoom: 50%;"><h3 id="配置定时器向上计数溢出中断NVIC-嵌套向量中断控制器"><a href="#配置定时器向上计数溢出中断NVIC-嵌套向量中断控制器" class="headerlink" title="配置定时器向上计数溢出中断NVIC(嵌套向量中断控制器)"></a>配置定时器向上计数溢出中断NVIC(嵌套向量中断控制器)</h3><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408100951812.png" alt="配置定时器NVIC" style="zoom:50%;"><h3 id="定时器-PWM-控制LED灯配置"><a href="#定时器-PWM-控制LED灯配置" class="headerlink" title="定时器(PWM)控制LED灯配置"></a>定时器(PWM)控制LED灯配置</h3><p>LED(PB5)引脚说明：</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408092327266.png" alt="PWMLED灯配置" style="zoom:50%;"><p>所以配置定时器3，通道二，但配置完发现图中不符，需手动修改</p><p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408092327594.png" alt="定时器配置LED灯"></p><h3 id="定时器-PWM-控制电机配置"><a href="#定时器-PWM-控制电机配置" class="headerlink" title="定时器(PWM)控制电机配置"></a>定时器(PWM)控制电机配置</h3><p>配置PB4引脚PWM控制电机速度</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408092330260.png" alt="配置PWM控制电机速度" style="zoom:33%;"><h3 id="定时器-PWM-控制舵机配置"><a href="#定时器-PWM-控制舵机配置" class="headerlink" title="定时器(PWM)控制舵机配置"></a>定时器(PWM)控制舵机配置</h3><p>舵机脉冲周期：20ms</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408092331367.png" alt="PWM控制舵机配置" style="zoom: 33%;"><h3 id="输入捕获定时器配置"><a href="#输入捕获定时器配置" class="headerlink" title="输入捕获定时器配置"></a>输入捕获定时器配置</h3><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408092328847.png" alt="输入捕获定时器配置" style="zoom: 33%;"><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408092332188.png" alt="输入捕获定时器配置" style="zoom:50%;"><h3 id="配置定时器全局中断NVIC"><a href="#配置定时器全局中断NVIC" class="headerlink" title="配置定时器全局中断NVIC"></a>配置定时器全局中断NVIC</h3><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408092332662.png" alt="开启中断" style="zoom:50%;"><h3 id="DHT11-温湿度传感器-配置"><a href="#DHT11-温湿度传感器-配置" class="headerlink" title="DHT11(温湿度传感器)配置"></a>DHT11(温湿度传感器)配置</h3><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408101440952.png" alt="DHT11(温湿度传感器)配置" style="zoom: 50%;"><h2 id="LED灯闪烁、串口输出运行时间"><a href="#LED灯闪烁、串口输出运行时间" class="headerlink" title="LED灯闪烁、串口输出运行时间"></a><center>LED灯闪烁、串口输出运行时间</center></h2><p>LED1每隔一秒电平翻转一次，LED2每隔两秒电平翻转一次，串口输出单片机运行时间</p><h3 id="Cube-IDE代码"><a href="#Cube-IDE代码" class="headerlink" title="Cube IDE代码"></a><center>Cube IDE代码</center></h3><p>main.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* USER CODE BEGIN Includes */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span><span class="comment">//27行</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span><span class="comment">//28行</span></span></span><br><span class="line"><span class="comment">/* USER CODE END Includes */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* USER CODE BEGIN 0 */</span></span><br><span class="line"><span class="type">uint32_t</span> G_Timer_Count = <span class="number">0</span>;<span class="comment">//59行</span></span><br><span class="line"><span class="type">uint8_t</span> UART_Count[<span class="number">200</span>];</span><br><span class="line"><span class="type">uint8_t</span> UART_Flag = <span class="number">0</span>;</span><br><span class="line"><span class="comment">/* USER CODE END 0 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* USER CODE BEGIN 2 */</span></span><br><span class="line">HAL_TIM_Base_Start_IT(&amp;htim1);<span class="comment">//开启定时器，97行</span></span><br><span class="line"><span class="comment">/* USER CODE END 2 */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(UART_Flag)<span class="comment">//104行</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">sprintf</span>(UART_Count,<span class="string">&quot;MCU run time is %lus&quot;</span>,G_Timer_Count);</span><br><span class="line">HAL_UART_Transmit(&amp;huart1, UART_Count, <span class="built_in">strlen</span>(UART_Count), <span class="number">1000</span>);</span><br><span class="line">UART_Flag = <span class="number">0</span>;<span class="comment">//打印一次后标志=0，等中断五次(5s)后</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* USER CODE BEGIN 4 */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">HAL_TIM_PeriodElapsedCallback</span><span class="params">(TIM_HandleTypeDef *htim)</span><span class="comment">//定时器触发函数,157行</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(htim == &amp;htim1)</span><br><span class="line">&#123;</span><br><span class="line">HAL_GPIO_TogglePin(LED1_GPIO_Port, LED1_Pin);</span><br><span class="line">G_Timer_Count++;</span><br><span class="line"><span class="keyword">if</span>((G_Timer_Count % <span class="number">5</span>) == <span class="number">0</span>)</span><br><span class="line">UART_Flag = <span class="number">1</span>;<span class="comment">//每隔五秒，让标志=1</span></span><br><span class="line"><span class="keyword">if</span>((G_Timer_Count % <span class="number">2</span>) == <span class="number">0</span>)<span class="comment">//LED2每隔两秒翻转电平</span></span><br><span class="line">HAL_GPIO_TogglePin(LED2_GPIO_Port, LED2_Pin);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* USER CODE END 4 */</span></span><br></pre></td></tr></table></figure><h2 id="PWM信号LED呼吸灯、电机、舵机"><a href="#PWM信号LED呼吸灯、电机、舵机" class="headerlink" title="PWM信号LED呼吸灯、电机、舵机"></a><center>PWM信号LED呼吸灯、电机、舵机</center></h2><p>理论参考：<a href="https://d3iiz.top/post/93c966f3.html">链接</a></p><p>PWM信号控制LED，产生一个呼吸灯效果，以及对电机控制，控制速度由慢到快</p><h3 id="Cube-IDE代码-1"><a href="#Cube-IDE代码-1" class="headerlink" title="Cube IDE代码"></a><center>Cube IDE代码</center></h3><p>main.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* USER CODE BEGIN PV */</span></span><br><span class="line"><span class="type">uint8_t</span> PWM_Value = <span class="number">0</span>,LED_PWM_Value = <span class="number">0</span>,SG_PWM = <span class="number">5</span>;<span class="comment">//47行</span></span><br><span class="line"><span class="comment">/* USER CODE END PV */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* USER CODE BEGIN 2 */</span></span><br><span class="line"><span class="comment">//参数1：定时器句柄(指向配置好的定时器结构体的指针)，参数2：定时器通道,93行</span></span><br><span class="line">HAL_TIM_PWM_Start(&amp;htim3, TIM_CHANNEL_2);<span class="comment">//开启定时器3，通道2 PWM</span></span><br><span class="line">HAL_TIM_PWM_Start(&amp;htim3, TIM_CHANNEL_1);<span class="comment">//开启定时器3，通道1 PWM</span></span><br><span class="line">HAL_TIM_PWM_Start(&amp;htim4, TIM_CHANNEL_1);<span class="comment">//开启定时器4，通道1 PWM</span></span><br><span class="line"><span class="comment">/* USER CODE END 2 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//103行</span></span><br><span class="line">PWM_Value++;</span><br><span class="line">PWM_Value = PWM_Value % <span class="number">200</span>;</span><br><span class="line"><span class="keyword">if</span>(PWM_Value &gt; <span class="number">99</span>)</span><br><span class="line">LED_PWM_Value = <span class="number">200</span> - PWM_Value;<span class="comment">//大于99时，从大到小(100,99...)</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">LED_PWM_Value = PWM_Value;</span><br><span class="line">HAL_Delay(<span class="number">25</span>);</span><br><span class="line"><span class="comment">//参数1：定时器句柄，参数2：定时器通道,参数3：比较值</span></span><br><span class="line">__HAL_TIM_SET_COMPARE(&amp;htim3, TIM_CHANNEL_2, LED_PWM_Value);<span class="comment">//设置LED比较值</span></span><br><span class="line">__HAL_TIM_SET_COMPARE(&amp;htim3, TIM_CHANNEL_1, LED_PWM_Value);<span class="comment">//设置电机比较值</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(PWM_Value % <span class="number">30</span> == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//每0.1ms计数值+1则0.5ms，比较值模式1，则占空比(高电平)0.5ms</span></span><br><span class="line">SG_PWM += <span class="number">5</span>;</span><br><span class="line"><span class="keyword">if</span>(SG_PWM &gt; <span class="number">25</span>)</span><br><span class="line">SG_PWM = <span class="number">5</span>;</span><br><span class="line">__HAL_TIM_SET_COMPARE(&amp;htim4, TIM_CHANNEL_1, SG_PWM);<span class="comment">//设置舵机比较值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="输入捕获-IC"><a href="#输入捕获-IC" class="headerlink" title="输入捕获(IC)"></a><center>输入捕获(IC)</center></h2><p>捕获高电平持续时间</p><h3 id="Cube-IDE代码-2"><a href="#Cube-IDE代码-2" class="headerlink" title="Cube IDE代码"></a><center>Cube IDE代码</center></h3><p>捕获PWM高电平的时间</p><p>main.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* USER CODE BEGIN PTD */</span></span><br><span class="line"><span class="type">uint32_t</span> ic_state=<span class="number">0</span>,period_count=<span class="number">0</span>,ic_count=<span class="number">0</span>,us_count;<span class="comment">//32行</span></span><br><span class="line"><span class="comment">/* USER CODE END PTD */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* USER CODE BEGIN 2 */</span></span><br><span class="line">HAL_TIM_Base_Start_IT(&amp;htim2);<span class="comment">//开启普通定时器中断</span></span><br><span class="line">  HAL_TIM_IC_Start_IT(&amp;htim2, TIM_CHANNEL_2);<span class="comment">//开启捕获定时器中断</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Please connect MCU51 P2.0,and let SG90 run to detect signal!\n&quot;</span>);<span class="comment">//串口输出捕获的时间(记得配置串口重定向)</span></span><br><span class="line"><span class="comment">/* USER CODE END 2 */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(ic_state== <span class="number">2</span> )<span class="comment">//103行(while里)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* 始终设置的是1us触发计数值加1</span></span><br><span class="line"><span class="comment">* 一个周期大概65ms，若大于65只有捕获中断函数不好使</span></span><br><span class="line"><span class="comment">* 若period_count为1，则代表过了一个中断周期，时间(1*65535)us</span></span><br><span class="line"><span class="comment">* 若没有到整个中断周期时间则剩下的为：ic_count</span></span><br><span class="line"><span class="comment">* 所以两个相加等于整个高电平时间*/</span></span><br><span class="line">us_count = ic_count + period_count * <span class="number">0xFFFF</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;High level duration:  %ldus \n&quot;</span>,us_count);<span class="comment">//(float)(us_count)/1000.000</span></span><br><span class="line">ic_state = <span class="number">0</span>;<span class="comment">//再将中间键恢复0，方便下次上升沿触发中断计时</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* USER CODE BEGIN 4 */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">HAL_TIM_IC_CaptureCallback</span><span class="params">(TIM_HandleTypeDef *htim)</span><span class="comment">//输入捕获触发函数,161行</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(TIM2 == htim-&gt;Instance)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> ( ic_state == <span class="number">0</span> )</span><br><span class="line">&#123;</span><br><span class="line">__HAL_TIM_SET_COUNTER(htim,<span class="number">0</span>);<span class="comment">//将定时器从零开始计时</span></span><br><span class="line">__HAL_TIM_SET_CAPTUREPOLARITY(&amp;htim2, TIM_CHANNEL_2, TIM_INPUTCHANNELPOLARITY_FALLING);<span class="comment">//设置成下降沿触发</span></span><br><span class="line">ic_state = <span class="number">1</span>;<span class="comment">//下次触发中断时(下降沿)则运行else</span></span><br><span class="line">period_count = <span class="number">0</span>;</span><br><span class="line">ic_count = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">ic_count = HAL_TIM_ReadCapturedValue(&amp;htim2,TIM_CHANNEL_2);<span class="comment">//读取定时器计数值</span></span><br><span class="line">__HAL_TIM_SET_CAPTUREPOLARITY(&amp;htim2, TIM_CHANNEL_2,   TIM_INPUTCHANNELPOLARITY_RISING);<span class="comment">//设置成上降沿触发</span></span><br><span class="line">ic_state = <span class="number">2</span>;<span class="comment">//进入while里面的判断</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">HAL_TIM_PeriodElapsedCallback</span><span class="params">(TIM_HandleTypeDef *htim)</span><span class="comment">//普通定时器中断触发函数</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(TIM2 == htim-&gt;Instance)</span><br><span class="line">    &#123;</span><br><span class="line"><span class="keyword">if</span>(ic_state==<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(period_count==<span class="number">0XFFFF</span>)<span class="comment">//一次周期大约65ms，若进入这个需要(65*65535)ms</span></span><br><span class="line">&#123;</span><br><span class="line">ic_state=<span class="number">2</span>;</span><br><span class="line">ic_count=<span class="number">0XFFFF</span>;<span class="comment">//返回一个超大数显示错误</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">period_count++;</span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* USER CODE END 4 */</span></span><br></pre></td></tr></table></figure><h2 id="DHT11"><a href="#DHT11" class="headerlink" title="DHT11"></a><center>DHT11</center></h2><p>main.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* USER CODE BEGIN Includes */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;dht11.h&quot;</span><span class="comment">//27行</span></span></span><br><span class="line"><span class="comment">/* USER CODE END Includes */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(DHT_Read())<span class="comment">//while里,101行</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot; H:%u  T:%u \r\n&quot;</span>,Data[<span class="number">0</span>],Data[<span class="number">2</span>]);</span><br><span class="line">HAL_Delay(<span class="number">1000</span>);</span><br></pre></td></tr></table></figure><p>dht11.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f1xx.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;dht11.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">uint8_t</span> Data[<span class="number">5</span>]=&#123;<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Delay_us</span><span class="params">(<span class="type">uint16_t</span> us)</span><span class="comment">//微秒延迟</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">uint16_t</span> differ = <span class="number">0xffff</span>-us;</span><br><span class="line">__HAL_TIM_SET_COUNTER(&amp;htim1,differ);</span><br><span class="line">HAL_TIM_Base_Start(&amp;htim1);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(differ &lt; <span class="number">0xffff</span>)&#123;</span><br><span class="line">differ = __HAL_TIM_GET_COUNTER(&amp;htim1);</span><br><span class="line">&#125;</span><br><span class="line">HAL_TIM_Base_Stop(&amp;htim1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">DHT_GPIO_SET_OUTPUT</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">GPIO_InitTypeDef GPIO_InitStructure;</span><br><span class="line">GPIO_InitStructure.Pin=GPIO_PIN_5;</span><br><span class="line">GPIO_InitStructure.Mode=GPIO_MODE_OUTPUT_PP;<span class="comment">//PA5设置输出</span></span><br><span class="line"><span class="comment">//GPIO_InitStructure.Pull=;</span></span><br><span class="line">GPIO_InitStructure.Speed=GPIO_SPEED_FREQ_HIGH;</span><br><span class="line">HAL_GPIO_Init(GPIOA,&amp;GPIO_InitStructure);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">DHT_GPIO_SET_INPUT</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">GPIO_InitTypeDef GPIO_InitStructure;</span><br><span class="line">GPIO_InitStructure.Pin=GPIO_PIN_5;</span><br><span class="line">GPIO_InitStructure.Mode=GPIO_MODE_INPUT;<span class="comment">//PA5设置输入</span></span><br><span class="line">GPIO_InitStructure.Speed=GPIO_SPEED_FREQ_HIGH;</span><br><span class="line">HAL_GPIO_Init(GPIOA,&amp;GPIO_InitStructure);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">DHT_Read_Byte</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="type">uint8_t</span> ReadData=<span class="number">0</span>;</span><br><span class="line"> <span class="type">uint8_t</span> temp;</span><br><span class="line"> <span class="type">uint8_t</span> retry=<span class="number">0</span>;</span><br><span class="line"> <span class="type">uint8_t</span> i;    </span><br><span class="line"> <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">8</span>; i++)</span><br><span class="line"> &#123;</span><br><span class="line"><span class="keyword">while</span>(HAL_GPIO_ReadPin(GPIOA,GPIO_PIN_5)==<span class="number">0</span> &amp;&amp; retry&lt;<span class="number">100</span>)  </span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">Delay_us(<span class="number">1</span>);</span><br><span class="line">  retry++;</span><br><span class="line">&#125;</span><br><span class="line">retry=<span class="number">0</span>;</span><br><span class="line">Delay_us(<span class="number">40</span>);</span><br><span class="line"><span class="keyword">if</span>(HAL_GPIO_ReadPin(GPIOA,GPIO_PIN_5)==<span class="number">1</span>)   temp=<span class="number">1</span>;</span><br><span class="line"> <span class="keyword">else</span>   temp=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">while</span>(HAL_GPIO_ReadPin(GPIOA,GPIO_PIN_5)==<span class="number">1</span> &amp;&amp; retry&lt;<span class="number">100</span>)</span><br><span class="line"> &#123;</span><br><span class="line"> Delay_us(<span class="number">1</span>);</span><br><span class="line"> retry++;</span><br><span class="line"> &#125;</span><br><span class="line"> retry=<span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line"> ReadData&lt;&lt;=<span class="number">1</span>;</span><br><span class="line"> ReadData |= temp;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ReadData;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">DHT_Read</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="type">uint8_t</span> retry=<span class="number">0</span>;</span><br><span class="line"> <span class="type">uint8_t</span> i;</span><br><span class="line"></span><br><span class="line"> DHT_GPIO_SET_OUTPUT();</span><br><span class="line"> HAL_GPIO_WritePin(GPIOA,GPIO_PIN_5,GPIO_PIN_RESET);</span><br><span class="line"> HAL_Delay(<span class="number">18</span>);</span><br><span class="line"> HAL_GPIO_WritePin(GPIOA,GPIO_PIN_5,GPIO_PIN_SET);</span><br><span class="line"> Delay_us(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DHT_GPIO_SET_INPUT();</span><br><span class="line">Delay_us(<span class="number">20</span>);</span><br><span class="line"><span class="keyword">if</span>(HAL_GPIO_ReadPin(GPIOA,GPIO_PIN_5)==<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(HAL_GPIO_ReadPin(GPIOA,GPIO_PIN_5)==<span class="number">0</span> &amp;&amp; retry&lt;<span class="number">100</span>)  </span><br><span class="line">&#123;</span><br><span class="line">   Delay_us(<span class="number">1</span>);</span><br><span class="line"> retry++;</span><br><span class="line">&#125;</span><br><span class="line">retry=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(HAL_GPIO_ReadPin(GPIOA,GPIO_PIN_5)==<span class="number">1</span> &amp;&amp; retry&lt;<span class="number">100</span>) </span><br><span class="line">&#123;</span><br><span class="line">   Delay_us(<span class="number">1</span>);</span><br><span class="line"> retry++;</span><br><span class="line">&#125;</span><br><span class="line">retry=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line"> Data[i] = DHT_Read_Byte();</span><br><span class="line">&#125;</span><br><span class="line">Delay_us(<span class="number">50</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="type">uint32_t</span> sum=Data[<span class="number">0</span>]+Data[<span class="number">1</span>]+Data[<span class="number">2</span>]+Data[<span class="number">3</span>];</span><br><span class="line"> <span class="keyword">if</span>((sum)==Data[<span class="number">4</span>])    <span class="keyword">return</span> <span class="number">1</span>;  </span><br><span class="line">   <span class="keyword">else</span>   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>dht11.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __DHT11_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __DHT11_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f1xx_hal.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f1xx.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="type">uint8_t</span> Data[<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> TIM_HandleTypeDef htim1;</span><br><span class="line"><span class="type">void</span> <span class="title function_">Delay_us</span><span class="params">(<span class="type">uint16_t</span> us)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">DHT_GPIO_SET_OUTPUT</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">DHT_GPIO_SET_INPUT</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">DHT_Read_Byte</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">DHT_Read</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;理论&quot;&gt;&lt;a href=&quot;#理论&quot; class=&quot;headerlink&quot; title=&quot;理论&quot;&gt;&lt;/a&gt;&lt;center&gt;理论&lt;/center&gt;&lt;/h1&gt;&lt;p&gt;预分频寄存器(TIMx_PSC)：由于时钟源为：72MHz，T &amp;#x3D; 1&amp;#x2F;f &amp;#x3D</summary>
      
    
    
    
    <category term="32单片机" scheme="http://example.com/categories/32%E5%8D%95%E7%89%87%E6%9C%BA/"/>
    
    
    <category term="32单片机" scheme="http://example.com/tags/32%E5%8D%95%E7%89%87%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>3.串口(UART)</title>
    <link href="http://example.com/post/2c4c3bc3.html"/>
    <id>http://example.com/post/2c4c3bc3.html</id>
    <published>2024-08-05T10:02:46.000Z</published>
    <updated>2024-08-13T08:32:56.348Z</updated>
    
    <content type="html"><![CDATA[<p>串口理论部分可看51部分：<a href="https://blog.csdn.net/qq_65047384/article/details/140470283">链接</a></p><p>数据帧 &#x3D; 帧头(2字节，例如AA、BB) + 数据长度（2字节）+ 数据 + CRC16校验（2字节） + 帧尾（2字节）</p><p>回调函数在：stm32f1xx_it.c里找对应的函数转进入里面找</p><p>中断函数：stm32f1xx_hal_uart.c（别的只是uart不同）</p><h1 id="代码编写"><a href="#代码编写" class="headerlink" title="代码编写"></a><center>代码编写</center></h1><p>串口一发送命令控制LED灯(PB5、PE5)</p><h2 id="LED灯、串口、串口打印浮点数据、串口重定向配置"><a href="#LED灯、串口、串口打印浮点数据、串口重定向配置" class="headerlink" title="LED灯、串口、串口打印浮点数据、串口重定向配置"></a><center>LED灯、串口、串口打印浮点数据、串口重定向配置</center></h2><p>LED灯配置请看：<a href="https://d3iiz.top/post/adb202b7.html">链接</a></p><p>串口配置：</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408061554189.png" alt="串口配置" style="zoom:33%;"><p>配置串口中断NVIC(嵌套向量中断控制器)</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408061555432.png" alt="配置中断NVIC" style="zoom:33%;"><p>配置DMA：</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408061554276.png" alt="配置DMA" style="zoom: 33%;"><p>Cube IDE中串口打印浮点数据配置方法(<a href="https://blog.csdn.net/caihaitao2000/article/details/112469098">参考</a>)：进入“Project→Properties”；显示界面如下。按照图片中的设置完成即可！</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408061554668.png" alt="打印浮点数配置" style="zoom: 33%;"><p>串口重定向配置：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">uint8_t</span> u_buf[<span class="number">256</span>];<span class="comment">//usart.c,24行</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span><span class="comment">//usart.h,32行</span></span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">uint8_t</span> u_buf[<span class="number">256</span>];<span class="comment">//usart.h，38行</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> printf(...)  HAL_UART_Transmit(&amp;huart1, (uint8_t *)u_buf, sprintf((char*)u_buf, __VA_ARGS__), 0xffff)<span class="comment">//usart.h，39行</span></span></span><br></pre></td></tr></table></figure><h2 id="轮询方式"><a href="#轮询方式" class="headerlink" title="轮询方式"></a><center>轮询方式</center></h2><p>缺点：</p><p>&ensp;&ensp;&ensp;&ensp;必须要等待数据发送完或者等待时间超时，代码才会往下走</p><p>&ensp;&ensp;&ensp;&ensp;必须要等待数据接收到固定的字节长度，超时，代码才往下走</p><h3 id="Cube-IDE代码"><a href="#Cube-IDE代码" class="headerlink" title="Cube IDE代码"></a><center>Cube IDE代码</center></h3><p>mian.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* USER CODE BEGIN Includes */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span><span class="comment">//26行</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span><span class="comment">//27</span></span></span><br><span class="line"><span class="comment">/* USER CODE END Includes */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* USER CODE BEGIN PV */</span></span><br><span class="line"><span class="type">uint8_t</span> UART_Recv[<span class="number">5</span>];<span class="comment">//48行</span></span><br><span class="line"><span class="type">char</span> UART_Str[<span class="number">30</span>];<span class="comment">//49行</span></span><br><span class="line"><span class="comment">/* USER CODE END PV */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//参数1：UART 模块的配置信息的指针,参数2：数据缓冲区的指针，参数3：接收字节长度，参数4：接收超时时间(单位为毫秒)</span></span><br><span class="line">HAL_UART_Receive(&amp;huart1, UART_Recv, <span class="number">4</span>, <span class="number">1000</span>);<span class="comment">//接收数据函数</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">strcmp</span>(<span class="string">&quot;LED1&quot;</span>, (<span class="type">char</span> *)UART_Recv) == <span class="number">0</span>)<span class="comment">//字符串比较函数</span></span><br><span class="line">&#123;</span><br><span class="line">HAL_GPIO_TogglePin(LED1_GPIO_Port, LED1_Pin);</span><br><span class="line"><span class="built_in">memset</span>(UART_Recv,<span class="string">&#x27;\0&#x27;</span>,<span class="number">5</span>);<span class="comment">//替换字符函数，常用于清除指定空间</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="built_in">strcmp</span>(<span class="string">&quot;LED2&quot;</span>, (<span class="type">char</span> *)UART_Recv))<span class="comment">//字符串比较函数</span></span><br><span class="line">&#123;</span><br><span class="line">HAL_GPIO_TogglePin(LED2_GPIO_Port, LED2_Pin);</span><br><span class="line"><span class="built_in">memset</span>(UART_Recv,<span class="string">&#x27;\0&#x27;</span>,<span class="number">5</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">sprintf</span>(UART_Str, <span class="string">&quot;%f\n&quot;</span>, <span class="number">666.6</span>);</span><br><span class="line"><span class="comment">//参数1：UART 模块的配置信息的指针,参数2：发送的字符串或字符数组，参数3：发送字节长度，参数4：接收超时时间(单位为毫秒)</span></span><br><span class="line">HAL_UART_Transmit(&amp;huart1, (<span class="type">char</span> *)UART_Str, <span class="built_in">strlen</span>(UART_Str), <span class="number">1000</span>);<span class="comment">//发送数据</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;xinzai\n&quot;</span>);<span class="comment">//配置串口重定向后才可使用</span></span><br></pre></td></tr></table></figure><h2 id="中断-IT-方式"><a href="#中断-IT-方式" class="headerlink" title="中断(IT)方式"></a><center>中断(IT)方式</center></h2><h3 id="Cube-IDE代码-1"><a href="#Cube-IDE代码-1" class="headerlink" title="Cube IDE代码"></a><center>Cube IDE代码</center></h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">HAL_UART_RxCpltCallback(huart);<span class="comment">//stm32f1xx_hal_uart.c,3660行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//stm32f1xx_hal_uart.c,2619行</span></span><br><span class="line">__weak <span class="type">void</span> <span class="title function_">HAL_UART_RxCpltCallback</span><span class="params">(UART_HandleTypeDef *huart)</span><span class="comment">//中断回调函数</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>main.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* USER CODE BEGIN Includes */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span><span class="comment">//26行</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span><span class="comment">//27行</span></span></span><br><span class="line"><span class="comment">/* USER CODE END Includes */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* USER CODE BEGIN PV */</span></span><br><span class="line"><span class="type">uint8_t</span> UART_Recv_IT[<span class="number">5</span>];<span class="comment">//48行</span></span><br><span class="line"><span class="type">char</span> UART_Str[<span class="number">30</span>];<span class="comment">//49行</span></span><br><span class="line"><span class="comment">/* USER CODE END PV */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* USER CODE BEGIN 2 */</span></span><br><span class="line"><span class="comment">//参数1：UART 模块的配置信息的指针,参数2：数据缓冲区的指针，参数3：接收字节长度</span></span><br><span class="line">HAL_UART_Receive_IT(&amp;huart1, UART_Recv_IT, <span class="number">4</span>);<span class="comment">//串口中断接收函数，95行</span></span><br><span class="line"><span class="comment">/* USER CODE END 2 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//while函数里</span></span><br><span class="line"><span class="built_in">sprintf</span>(UART_Str, <span class="string">&quot;%d\n&quot;</span>, <span class="number">666</span>);<span class="comment">//102</span></span><br><span class="line">HAL_UART_Transmit_IT(&amp;huart1, UART_Str, <span class="built_in">strlen</span>(UART_Str));<span class="comment">//串口中断发送函数,103</span></span><br><span class="line">HAL_Delay(<span class="number">1000</span>);<span class="comment">//104</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//151行开始</span></span><br><span class="line"><span class="comment">/* USER CODE BEGIN 4 */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">HAL_UART_RxCpltCallback</span><span class="params">(UART_HandleTypeDef *huart)</span><span class="comment">//串口中断接收触发函数</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(huart == &amp;huart1)<span class="comment">//判断传进来的串口是哪个</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">strcmp</span>(<span class="string">&quot;LED1&quot;</span>, (<span class="type">char</span> *)UART_Recv_IT) == <span class="number">0</span>)<span class="comment">//字符串比较函数</span></span><br><span class="line">&#123;</span><br><span class="line">  HAL_GPIO_TogglePin(LED1_GPIO_Port, LED1_Pin);</span><br><span class="line">  <span class="built_in">memset</span>(UART_Recv_IT,<span class="string">&#x27;\0&#x27;</span>,<span class="number">5</span>);<span class="comment">//替换字符函数，常用于清除指定空间</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="built_in">strcmp</span>(<span class="string">&quot;LED2&quot;</span>, (<span class="type">char</span> *)UART_Recv_IT))<span class="comment">//字符串比较函数</span></span><br><span class="line">&#123;</span><br><span class="line">  HAL_GPIO_TogglePin(LED2_GPIO_Port, LED2_Pin);</span><br><span class="line">  <span class="built_in">memset</span>(UART_Recv_IT,<span class="string">&#x27;\0&#x27;</span>,<span class="number">5</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//因为只能接受一次串口中断，所以在串口中断触发函数需要重新调用</span></span><br><span class="line">HAL_UART_Receive_IT(&amp;huart1, UART_Recv_IT, <span class="number">4</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* USER CODE END 4 */</span></span><br></pre></td></tr></table></figure><h2 id="空闲中断-IDLE-DMA"><a href="#空闲中断-IDLE-DMA" class="headerlink" title="空闲中断(IDLE) + DMA"></a><center>空闲中断(IDLE) + DMA</center></h2><p>不受接收字符长度影响，可以随意接收字符长度并判断，DMA会触发中断</p><p>空闲状态：在多个字节传输结束后，通信线路将会维持高电平，这个状态称为空闲状态（没有数据传输时的空闲状态，数据传输刚结束的空闲状态）</p><p>空闲中断产生条件：在数据传输过程中，当CPU检测到通信线路处于空闲状态时，且空闲状态的持续时间大于一个字节传输时间时，空闲状态标志IDLE将由硬件置1，产生空闲中断</p><h3 id="Cube-IDE代码-2"><a href="#Cube-IDE代码-2" class="headerlink" title="Cube IDE代码"></a><center>Cube IDE代码</center></h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//stm32f1xx_hal_uart.h,2710行</span></span><br><span class="line">__weak <span class="type">void</span> <span class="title function_">HAL_UARTEx_RxEventCallback</span><span class="params">(UART_HandleTypeDef *huart, <span class="type">uint16_t</span> Size)</span><span class="comment">//空闲中断接收回调函数</span></span><br></pre></td></tr></table></figure><p>main.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* USER CODE BEGIN Includes */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span><span class="comment">//27行</span></span></span><br><span class="line"><span class="comment">/* USER CODE END Includes */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* USER CODE BEGIN PD */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RECV_Size 100<span class="comment">//37行</span></span></span><br><span class="line"><span class="comment">/* USER CODE END PD */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* USER CODE BEGIN 2 */</span></span><br><span class="line">HAL_UARTEx_ReceiveToIdle_DMA(&amp;huart1, UART_Recv_IDLE, RECV_Size);<span class="comment">//空闲中断接收函数,94行</span></span><br><span class="line"><span class="comment">//数据接收RECV_Size一半时会重新触发中断，需要关闭DMA接收中断使能</span></span><br><span class="line">HAL_NVIC_DisableIRQ(DMA1_Channel5_IRQn);<span class="comment">//96行</span></span><br><span class="line"><span class="comment">/* USER CODE END 2 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//150行</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">HAL_UARTEx_RxEventCallback</span><span class="params">(UART_HandleTypeDef *huart, <span class="type">uint16_t</span> Size)</span><span class="comment">//空闲中断接收触发函数</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(huart == &amp;huart1)<span class="comment">//判断传进来的串口是哪个</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">strcmp</span>(<span class="string">&quot;LED1&quot;</span>, (<span class="type">char</span> *)UART_Recv_IDLE) == <span class="number">0</span>)<span class="comment">//字符串比较函数</span></span><br><span class="line">&#123;</span><br><span class="line">  HAL_GPIO_TogglePin(LED1_GPIO_Port, LED1_Pin);</span><br><span class="line">  <span class="built_in">memset</span>(UART_Recv_IDLE,<span class="string">&#x27;\0&#x27;</span>,Size);<span class="comment">//替换字符函数，常用于清除指定空间</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="built_in">strcmp</span>(<span class="string">&quot;LED2ON&quot;</span>, (<span class="type">char</span> *)UART_Recv_IDLE))<span class="comment">//字符串比较函数</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//HAL_GPIO_TogglePin(LED2_GPIO_Port, LED2_Pin);</span></span><br><span class="line">  HAL_GPIO_WritePin(LED2_GPIO_Port, LED2_Pin, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">memset</span>(UART_Recv_IDLE,<span class="string">&#x27;\0&#x27;</span>,Size);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(!<span class="built_in">strcmp</span>(<span class="string">&quot;LED2OFF&quot;</span>, (<span class="type">char</span> *)UART_Recv_IDLE))</span><br><span class="line">&#123;</span><br><span class="line">HAL_GPIO_WritePin(LED2_GPIO_Port, LED2_Pin, <span class="number">1</span>);</span><br><span class="line"><span class="built_in">memset</span>(UART_Recv_IDLE,<span class="string">&#x27;\0&#x27;</span>,Size);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//因为只能接受一次串口中断，所以在串口中断触发函数需要重新调用</span></span><br><span class="line">HAL_UARTEx_ReceiveToIdle_DMA(&amp;huart1, UART_Recv_IDLE, RECV_Size);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;串口理论部分可看51部分：&lt;a href=&quot;https://blog.csdn.net/qq_65047384/article/details/140470283&quot;&gt;链接&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;数据帧 &amp;#x3D; 帧头(2字节，例如AA、BB) + 数据长度（2字节）+ </summary>
      
    
    
    
    <category term="32单片机" scheme="http://example.com/categories/32%E5%8D%95%E7%89%87%E6%9C%BA/"/>
    
    
    <category term="32单片机" scheme="http://example.com/tags/32%E5%8D%95%E7%89%87%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>完美解决443端口被vmware占用的问题</title>
    <link href="http://example.com/post/b94c2cf2.html"/>
    <id>http://example.com/post/b94c2cf2.html</id>
    <published>2024-08-04T14:54:51.000Z</published>
    <updated>2024-08-05T10:03:43.785Z</updated>
    
    <content type="html"><![CDATA[<p> 第一步，打开虚拟机，找到首选项</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408042305038.png" alt="进入首选项" style="zoom:50%;"><p>第二步，选择共享虚拟机，修改端口号，保存</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408042304709.png" alt="修改端口" style="zoom:50%;">]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt; 第一步，打开虚拟机，找到首选项&lt;/p&gt;
&lt;img src=&quot;https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408042305038.png&quot; alt=&quot;进入首选项&quot; style=&quot;zoom:50%;&quot;&gt;

&lt;p&gt;第二步，选</summary>
      
    
    
    
    <category term="Windows使用技巧" scheme="http://example.com/categories/Windows%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/"/>
    
    
    <category term="解决443端口被vmware占用" scheme="http://example.com/tags/%E8%A7%A3%E5%86%B3443%E7%AB%AF%E5%8F%A3%E8%A2%ABvmware%E5%8D%A0%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>win10桌面图标变白</title>
    <link href="http://example.com/post/a06b5fda.html"/>
    <id>http://example.com/post/a06b5fda.html</id>
    <published>2024-08-04T14:54:31.000Z</published>
    <updated>2024-08-05T10:03:43.785Z</updated>
    
    <content type="html"><![CDATA[<p> 1、双击打开此电脑，点击【查看】，勾选<strong>【隐藏的项目】</strong></p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408042300201.png" alt="关闭隐藏" style="zoom:50%;"><p>2、同时按 【Win + R】键打开运行，输入<strong>【%localappdata%】</strong>回车确定</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408042257970.png" alt="打开命令" style="zoom:50%;"><p>3、右键选择删除<strong>lconCache.db</strong>文件</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408042257244.png" alt="删除文件" style="zoom: 67%;"><p>4、同时按【Shift + Ctrl + Esc】键打开任务管理器，找到<strong>Windows 资源管理器</strong>，右键选择重新启动</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408042258681.png" alt="资源管理器" style="zoom:50%;">]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt; 1、双击打开此电脑，点击【查看】，勾选&lt;strong&gt;【隐藏的项目】&lt;/strong&gt;&lt;/p&gt;
&lt;img src=&quot;https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408042300201.png&quot; alt=&quot;关闭隐藏&quot; s</summary>
      
    
    
    
    <category term="Windows使用技巧" scheme="http://example.com/categories/Windows%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/"/>
    
    
    <category term="win10桌面图标变白" scheme="http://example.com/tags/win10%E6%A1%8C%E9%9D%A2%E5%9B%BE%E6%A0%87%E5%8F%98%E7%99%BD/"/>
    
  </entry>
  
  <entry>
    <title>通过 Cloudflare 和 JsDelivr 免费加速博客 GitHub 图床等静态资源</title>
    <link href="http://example.com/post/3e643b17.html"/>
    <id>http://example.com/post/3e643b17.html</id>
    <published>2024-08-03T09:25:05.000Z</published>
    <updated>2024-08-03T09:42:00.254Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="9646e9724ae92f705f7a96d85b5ab68cc226132556d154bb3fc0d62b8c047962">d0082e95ce53ece4a4c0f5b8a727fc3f962b5c64e8654922e002aaab68a80fee44659e4ed481944adba9187c18a549696eb845bfa6a1cd0190d87af65317bf0556e6003eaf2e57f4faffd9d5095487d749f4baae378a311e09dcce66eeab912ac4701baa5dd63ec753c525efac934109102b75663fa19d2d1b179fe6a5bb9adbb69749d9a983dad87682f2332eff7dff76347dfd37b7626947f2ae9e1a239a3b15f8504a5cbf1a27530c16e0e1ff89a2848b86074ea4d6d304f104026e796a57d932698fe0f67e0078e91f3e72e15c2b1dc34c0123be4fe4f7273e6355fb018dadde48c0f9e308629f0a8d1de2bd0f017d5f2283d25fcb967dcfacf686c1ec607a3f18edcfdec9a61386b9957d0b959c9cf373de4d46657725c081d28313b42f3127612a27b06fa4e81489d37f86e30df43266280b207184a2de27af22c257b28c68008d73f3020982c72f87bf8a11e627ade32279fada559e38954d534a7668c06c8f1a89c598d799d5690acc6d621bd4b6dcb7043c6852ead49d8f1a5097f563b168dedd5e34dd3324e16fa8f624adaef0047a3bc0422febc28e6470d318cbf21c0a2df3d7b76948e436c5723cbb5aafa639f810ae257c8c4a39de99abf541ae3b69316187d2b3cf65e5059d83b79056f76e95ac47a3514dc0ba02cc5de07a7d0c99199d3548da29b2c05498ee27164ea50af3d780fa538fab36da198892c77c0f4538a06340f5c2ecce98487810962657452c84b519a1f5a0750198bd0a5234778ae451d476dbc40388f0d655c21acf381e04b6c32df16831ee1ba04bb54df50f64c50581c30118fa2ea6b19fe7d7390d309017725d50e733f809b242adc5c521fa8022a9493bbab4beac16206f88e3074ec10b6a632311e2a3061ae0f6d6c5f1d2e41a765e65aa1540cb72f97c2af5b4319e6e198521173fe6536defe4b2538e241b40b38d92945843a3c792eaeb77fb452ecde97dbfde700512a40aff0ecef38f1eec3485f8815dee1aba4c6dcc9bf2a531c6e95a46a5c7fd12a5b905ab3dbb4d5729c43a9cf3eeb2a544e7435d6b09431494b0c16312964189a8a59368a7e429ff1f25a655570c6e679f7779e62b4ee34ee1f31e1d911d627b0003564d81ec6c38df1db57419d106208dc33010226b78194c9194c19436605a59bc6f1efe489f4b2c6788a6300c761a4f09e00f155e67c83e1352bb39fe20ff46be21eacdb1884dbb0ad78bd84af4c7aa5e6b26dc3659601f8e58c4ed198cdb64fbf83c0abd537f775f0b25741e8a8724299c5a3e24a2dcc076e70ffbb73b024f367efe1cd2200d2be4d243924ad1e93903a748022fb72973c2079e17ee1a7bd4bb34de41e7aa0a5694e600f5bd4ce9bf38e63e6e2ec0df1116a4ea1e7595ab182a94da14aad10ee24d922e1594c43a0b1722eb304141f3ea0949cbc10ce6a30819e1588d7f15a48404857c089c37050b179f9e3011827ca4e870c69127d7967fac6052044a9ff49c2b9d3d689ee09555583b0943546aeb7848599e3289e2eca9772999de745bd5fc8aebf00297dbc6a5d7671df28eb693310d85255a1af2ca2dfc91b255a44d91b5d5b65eedd3df95ea6fabdbde49108760049e16b578f351c318a921e2be2a45b7f8453a3722ecc02533be71fa53a5ae888d1555f629427ef0226010ef385427e8d01f33174d9c5f1417efd71cbef03090ffef959422a452c9ec5f8caa356c1991b91d8a41c2dc07ced212692dfa8d2230da25bd6035baacd37b9c85fdb7b780cf76121fcc8607c20ebdb076ab97fdfe0a6b710d0792b944bd5a4a30255185fbc5912bf26577070260713b33825c8151e1de6b210f4f230262d0bf09a76b7b38ef5a5b88e0ce47a83c003e44b46195d72448b6fc2f0ab1f1f3099025c98018c1b0ae5ef593fb0dc7be100faf469ec2f5c88f777eaaae9db25cf488f9ae0e50946c12984d5451dd55b6778aba8546d14a0895d9d2c78e0384da653fa51b082ac8c081d60b204e38fc3ec71db8e1ac9c88a82bc04174470ee9e0d1b5dcb910b822439ab9ce9e26fb7a438ecb9e029be795cac31f50fff9c8d7fb2875d9ad7e6e826d1dd8a94db67d5bbbf74ff0b0092aea9315ce0bfb79f454be73232970df6c30c611354327f9fd9fec91109b4b95e2ef55a2352e7acd347a9e9c8df8bcbf8d886cf972eafaddb67475305092e2361f87895d049ea61b3f8b900fd7f36dc8b5447f69765b9a5d6c85be196a4bef75206c1a85117dbd1a94f7eae7b6a382c80d9512d2eeb32b9bdafaf407d572013957d5fc35fdf4b17b92e79c7b4c2dbdcfdd5dd47d4d0023085173d6c980c0a50ff9feff84a800c632e87afdd3a33611e983daa937d2f6dc225dca513e7a9025a0d56182cd908de55befba39fd1e22889e56f6f112b537144037916113a2af21415118f89f4f3ba281c5fabaad490e469a6dcdd65db1e92010f5f363c47f67133e87a530ceaaa94ebf3ac7db8710c210f93b0c897a6c08533e8e6580968e09e0e465851b60b9ea29c6ba0186cbb2deeaa9dce514e8af0d87c799c2e2a361fe814f45efecbc59a0836bf14f8d0e8a3b4f3f99484e87c86f150c3736673f8683a2a8616173d3921f1e6364c8e906f28d75a8e8e1b7261bc3a3fb13aa003e646e8777eebb95efc906c8c7fd4c83c03224f67fbcfacb22ac7e16a8fc254ff85d66433f6aa16ac0da45a370aad933c43aac76b02fe8303d22bc62155fb4ece10f8b15aa840a570263324489ac45d099a1a929fa42950baf132d89f691e024366c639b4bc25324f9ef61fefd8e4ba5f847f7b83055fb3000200cc92d91e101a23931d184a34064c4fb5cd2cf2ed1ff6b60888d5c2774ea34a14c1ad659985562ea00d1a55696f700114542698f6188fe0aed6c89b6e46fab7a18fac5cb5898d1b5ccf8e12ee70940136cc0797c7e20532e48ecdd502523852a03ed89425e3bd8b0f507a92e3dbd7e9e278288e340130661eadceb6ca4b8e493bc0aceba158ab67f47722a4a4d45b89725669c2e7ea5dd8473dd00b49a7250ab8979c59054a6bd24b604bb2ba959dd41d482c05af755eb62c5282db2f22a934765c013aede426fbf7254a1e6df970f41f2022b7ff28ea43fdd890f10298d6a006a38095d925d35955aa75ce799a7fe3f19456efa518be52d190407b29efdf8935f5df7f61da0b9f72fdb5ed3939c0f60256db886662e793644f2b167baa50fbfa1bd2df03967f151938a441aec234722bb1ba4c98620cc9751a5390d4919834c20f2c6395a8dfbb3be9d817fec1f55efeb94cce5b11225e21e32de0bb4f3406ea1de724c13639803ca742ad191631051d197a20dcd8f0be7fa6802071c987734a3aaafc8e418be707bdd58a34dd35d1ce4ed7de8b9196731159bed15cf1b43cf38ff5cd94c78d9e2e9d62d53c753c5242fb21ccf5ff82b30588c015e0b11f85d81383049b26329aaa895f2c0f1f7545ad470caada617129795eaaa553fb7aad1b15a08e8e5c717055496420a37a546d8f8704fa95842bb6d8a9344a4bd46e3f75f2c9ef15727c90063d260edd72b66679d675448bf3dfa50feabe4c62c37b24ab51e0e8a6210d7e0d5073303cb038dfca1cb5f90600ae74f365849e502682dbbbd57a15698f5877e3dddc4ae2a2ed9d8776c582e61c54fc2407d3469b0071af5c5bd32d3f4ac4c2ec7499100a3c567c02c5c24647fec2ed150e71a3c882b4122bd3e98e12311c394a4fa0f13cc6513a183c59ee1b4108ecf60c066d18ced28dfc0a22b3feaf3ec3168691309ee028abafea8d7768418f321556fe3ab9ea16484debbc05ee9d815031fb2f6ebd1c8b14f3dd170007a05074e00b7053e3e4a37ba3d4d72d82a9eeb60f6a8f1314bcc0596bcd514e2545944288571f1f3224c93c0c669c510d2ca7c58c2b00b29e4661f96ebbeada866028cf33c048675e40628b98e8c396c62f35af953c4e5fdea6af7f8fedfa2fbde581f06dbaae55fc08b89e5aeec6f875b44de4a7a1f704d0e8578a51d1ee27bb5861e96d59d76a621d0485e6d0a34baf3d7241ff0e83e28afb648245914b99019f9717dffa54802b5546d5a27f1b4f7ffebdeb467829f4f0864e14aed96c49f8a7d6872d924f642dd486abcecb23b0e8a0d8d5e00ef14e7420ce22656d03f4f34093607e1850dc7e3ebbb5c08e5bba0b4ba6e8ed02f9bb18272bf8a6f8c2a2f9cacc603dc566a8439ea3a43c7dd1ffeea86e1e13c4ad7d36bfb25996cb69708bd561b62e9dcd998628fc729f6c4e37eec0bdb5c17d2b1059c68a3745123188e167dc59c7a301a772faad917670a5add126d30ecdea86e26e21f6f9794211c83c21c536aa84346ecbad736f7d5049a6c1d8627b315f86a13a4da8177f08d9236ac6c57b39a7dc3d13188b449092640bce3f14fcb8fbf5e80f4c470f7d311372807b77ae4cd12873951e1e3b7a358cfae8bf8b024085cb5ec2c8828ddf2e4083d7e298073ae70474693f88812aefaf6a23a6f92e07ced47c943f75f5b590ec81824959e4ee63516025829483433d59645d1cc0c1c1e98416432a2c8b4596668cc4e18e205157ae773a80a97eb34e35b7839db8b82d3c980335da99c3881d29381ebb57696b4c5dad45934a15889ce1434231991f9821108f2b96a6f443236a2087dafbf237489f03d04624c4624468f27ee46919ff3da8e9f50830a5fc2ad8a49443ade3da99c33634f4f5c12216417b22bb785180bc5358660cfd83623285f1a1292d3722bf3a47badc52310c6c017059ec1296207dce7f3ca848e8b8a5c1485d152c3c6d1ea9a2192810a04c8e3f6a094023721c518be18305416517c6aa18b5406db8f73d82cb68cf284118b60a15f16dc5b4bf25e7da0cd021eb34f101b4019f492284bc0d7e78e8db859504113cbfafa16cc61728e47c9ccef01050624897a7a2f5fe5f95f6fb5e9579a1e1ff3626d6430eafb1414f88ed659cfe841e35a0eb0f98c61188d02b2e42d3b857f75e7c1384bdd7cf31fe8fbfcdfde9301fcff9c0f1401ae6c9171c44a37a5b158bc93fdabc4350ba0e786b2e734a202826e3fdb62bdcf3aaed92f50716ff5c1849f5342cf252837262856886de73ed0264fa358cc01802a3529f4de48eccd54b2455273e3ad2acdd72bc29f597fd4f49089c3dd091b3e8a639967ce48b1b8a3273badbf85e19794b5f3f57f31cbb840960628642e7a191ec704252e3f795960abda40daa472415101704a93716fd08972a9bf30d531b6f9cadfe2ed3c07229e3fa0bbeaaab313ae87c8caa676323e85a905c71f193ec187</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">输入密码，查看文章。</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">这是一篇加密文章，内容可能是个人情感宣泄或者收费技术。如果你非常好奇，请与我联系。</summary>
    
    
    
    <category term="技术积累记录" scheme="http://example.com/categories/%E6%8A%80%E6%9C%AF%E7%A7%AF%E7%B4%AF%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="博客加速图床" scheme="http://example.com/tags/%E5%8D%9A%E5%AE%A2%E5%8A%A0%E9%80%9F%E5%9B%BE%E5%BA%8A/"/>
    
  </entry>
  
  <entry>
    <title>利用cloudflare加速github博客访问</title>
    <link href="http://example.com/post/b7e3ace9.html"/>
    <id>http://example.com/post/b7e3ace9.html</id>
    <published>2024-08-03T09:24:43.000Z</published>
    <updated>2024-08-03T09:41:56.950Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="38fc50883cdc84802e0b80820bedd2c692f44c0c23f6f17b7c25862b35698eec">d0082e95ce53ece4a4c0f5b8a727fc3f962b5c64e8654922e002aaab68a80fee83bbcc8e4eb80167e19b8e892dfbb77a3cda9d69557aa778ed5bbe612c7977025171d07e2ceef11975defba8c5fbcab9a1761ba2df674c84a71a7d37f0c1a834a86cc384e3a06f4cb0f7161ae0f28a4432e78178e1cf2f748b1f6c3a038ac08c99428636ce361a0e3a510ce92339cb05dd6359cde1ebfb9b14f9fd218cc0aa5b7b16fd7f884aa467a392b8fe9f1d3d41785c725b23e2eb38aa3dc45379375a4cef353d2c2724cc7081060c0b0a957bc56acca24cf913eb80126669e720f996560ed9fdb0f057b061de75ec1c045ea01e9f98595ed026f3ef5a05ff20eb1d48208a32b148be3b9e5ab244ea217b356a7fbed10b0ca853d5a720daf87693b8961423b9cb4f7e70fdfcedb1e55648ce4fffff7a75f440d06a0fbd3d7bee3c9db24ff7d715139372e4a8ced36ad1d814e13e71947c7eae9e3b50253c2b911dd1e4eb95bb2fe6ab813244b58217f9592aaf6f6c9415cd2bc1e89b7fce88357e9aba755a12d87b8462b6ef2e4f1d0b9ffd26527ec3102f72e81b896ba8264e4bd115491bf92ddb37031505b31885356760544a790578af015a44b31e503a6a2d1279d85eb8d9750915d74381732101649c6d649bd21d55614b89dcee6a5a965c465ba0398b9970a1c0dbd1d0f8068f00daa9938e1f56b130a92c4ef30be11911a85a0295c9241396003a603e5f5effd1a4661090b4b41b24d1de09a10e46cadac703d1b5fb1ed815e04c60eea3cc94a6b3976ba37d8c89cac01afed02338bf7514215a155067285d19888d0f063738de6146776f1f0b2b1a85536ef0f9c2e727b988c62fc4276b069570420fda5403e53ab0ec164f4b03aa5219d8a860631b831753a7bd0788a98cd47e9a882cbf015f4c97922f0876f983f5e42359116a6d579fb6184f01c9cd108b65ee7d2f0aca82f96be47dee684006b0cc363d577957937011b114208de1d00c3c255bc78115fbea2ca29a9b4cd042c76d383d325f636cbd93d9934d6d51320f31ebd11ec806110b2e64642f7de7aa113a0872ff39efd73221b7bca1cb582ca8b19e98cbbc40bde0c7642cf403b37e1393c7f10cc1f559191621e23242b6c1231d9a0cabce363ae79ef90eda207e3874f57d744c965ce3d664d0ccba10bf8ffe9256d271b365ac009d394e78e2996f54a2952c17eeab6b84b83b1907d38bf71dead0dea2e73d1506f32e00781f5327df26ca932dd07b56c663b1236e6253a5880c86e3bc9d65933fa17180b9b5425f52abfcfb89535a9d0b8245c139534b41a88c1dc75040e23fcb639af08bbf13d011485855ca8cae8b4ee20588de5773667ef11648e36cae4a6e35e76f8dd652af1fc46b6d077b9ebf4a6f06cd881f7624de640f7260cbb12ff39ff82df08f89a54e68aced3a5384caae459f1c1f952168c55b4946df36033d679350205cea667f8773e833f6f7032c7fe7d3efda27188319bbf062cd4d1711ce70c86cafe0ea30ca39982e8575105dd948a5874770925209d4037d710948ff6b669b52ebbc7fa35cc82cbe3766af86fb537b2ed742d6422e93210ff331f976760bd99a2eea0d3ef07c223a15eb4f0bd5d591ba4e69b7607af44362216f21f6657bc6f6ab7a7552ec4363a6c4b8430bcc6f96d9a1a350bfe0a82b70235dc191390f42a83163f1eb6ed918c6a1fa54f0c04e4761e71a3ab73a2c7f03413d258a4ed25ec905fa3789a4b32e1b87086e9e1658cdd1bb2c79809d97542c5998cd390ceacf67d06586e2a0dbf9329b593663c412312d4f512ef4432d501adc3cd1efa0d525d2b956a2387cd34b23f48126eb21e31c1d2c409964d35dd10c34628332a6fd7138558caab1b3bbfcc046942cca9c1cf1b42c2c83372604b7520604ad49063321dc7f64e63a37a31ef7512adc9b8a84d27fc27046afb82080c5d7ce1e1c7e4b9522367d8ba008e6ff1c507034b620825ff9647c2ecf642d4bdeea560e11caddf0a58bdb60c90371fda858d499487cba5a3b9acafeea8ba44234bc780b2916936fdcbefa9a27fd22fe328d3d4be9838d8a6af59e5d0864519f72b0b7708df9d56f4cfed7409ca73baf4ad614947d1fbc985439a452a0736982909d53b6aa3aab2303177ffb4d4d15f745df4522aee7be56070a6609a8ce826f818d0ee840b67c7fab932094ab18b56ee87c5da962d106c37dddb972d812cf92841549831162a0917987a19f71d8d712fd14107bfd1a3d3e24c04157bcf8e645b7f1a42de701fa2eabfd02e953dbb60661b2c78cf59f5ea6aeaa83c4c4965cd0fc0307f09e4d9dba8af3c2207f97f5647a4626ab275df167ce7135f0c50d55424679583d98702cec4e330af82cc30f0eba8d8597486445acf1b748c3b86e28e3b6e2c3b56b8c02cc9a1725ada985c744e417899ab36ce5a83c259f320223d94f7eb70fec303c12a7c0353a684d76f7ad27742db22d6b6ab51705ae4b19f9633f1c9408cd91ce677d725df344456b1b580ce5456d50efafb8956513dbc8c7cc93912359c9bd270fe5337f8ec792915fe591276aafbee44ef123d3540aa8ab1b7a8f3863c05582bccf54b281b6151cc7460a5c5da18454c9abdb4927069f210f926cc8841d2c6a7d7903ddc34d6c5109e828875e1530bd0fe29f3100922dd9ead420ccc2366602894cef6defa2ff89a28677ee7a1c42ba9240b9fd3fb764f66c72c1bb17db7d71d0d9c373021c5507026daa1ba6e1c0f35c6d5074149ab5999dded20b28a9996a406e3c319468429aaf0d496baf4ae03d89d3d9b9857b092d8de7f2b68bf85eca641ea24be79afe2f26d90d95de3ce4929ce4fedbdee0a4128a1a34cb6e34f6173c5487ce467a6756ca839582369bb99d21cfd476e2bd1343f5c26ab419b09fc50a53a6b099430c5ee8288b2d75a4c50f3732b8dc94ff6365aa9a74f4b9aa40458eadb2eecc65144fbea3e65d1f7e8dad0fe30138b47d770ab0c7cfce54b5980a1081a6a34226eb3e9757da0c774ee4430352fe740021e60a780105e5c14907c88aa3dcdbeb99fe2c90eb0cf2a3a66d8df87c8e361998eb23d13435c49b6a8b20269a04ee720d89525179f4c1d9f9b0f6597e286bbb31de2a2e035a083e7ab03624447d089edcd37022e3333fff9ae93af30ea1ee9acdc0e731c9f5d026087272692f340220490605428aa3f78b68a34e30ddfa5d5eee15d3809243ebdc785bc192b3776a2f12dffbb1f4ca0e1cb1b424834ce6c253c29298007e62a32c2a4ed35b1ff2f3742f58718d6fb20727e841075891cb5c80762dfb3f356b64ae9dd7810d99e2beb7a5ceef2442a084198877d7cb2fadcf67e4ee4159dbae19f842a001388d49a92beb915fcf6a80b8f5c51fbc10e11c5f66eb7e618c29ed66ae3e46676f03447177e0343a76879286ad102ad0572f01b7960e76c9724ccf2956e213296b9aff0b721a37592f17422ed27663a62389899cacca5b8e12588d0dba4f40be43c565e26a28646fa88ac7af574bd4963e3d12d496faf9e3cc1714b74de7acf1f95975cc48c92718abefc3a7ebe829795dff6b21f470d2e018f50e12f5586945289cad4c6fb4b5ab8d1391980646b1dca7af22da622ec10804d28a7e996e264b430b8e652f67f6eb6b63e78240145f4757af9d194764e8c300880c360f611fc989bfbfb47d9c791168e6de25bcc5ff219736d7e68b61a40600ed072588c37a8f2b0677c6795008a1546b23d4c0693d92615ad1cc1ccdfe5d2585d79fbe0e4598ee3980029e7b902e947369caacaeb562420057899d5af0fff49767d5aa709dc12063b0efcfc8f1c0b5120643f51af377ef912eea4605c805d0a1c7bb42b3d81d9b8d74d06393819b3b0f91044e9603e44a22840efe5fe1561d4523c2fddcd5dc80798785040b08ad47287ee91474896bad9c88a767f098d2347b017c6ba68f64e74d77668860d5b8dfa3f3aab60c3e9805cce5d262c55d2a3fcefc4b7137a3a3a11f74ec9acfaedb82d881a703d0c08cc9850844d58c7edfb949dd8d4f0a5cfbd4ee8cc01413bd3d0056d902a1d2f6434c3675b7a920000a922270534519d3c63a41be51e2e853e356bbe3dfe2db1d6266e0c6cc3f98195bc220ebbc22b127b41551448d4cfaddcd53f6c6b60d6258e6c6a2fc2b8723fd2795a2795b5d96443cff057af895263cee1a6b399b28adba503928ed4324794e252ca905597f27f127558a07a7ceb81ffbd42a8863ca81e7660da0cbff05fd8fe7389f4a7741d4b19cd63733f07f904a9a31717fb3ac06bc2e08f9d632f1d079400e0299e5f21e17b53f26efd7baa230ec6c2c008bace43559bb84143a2261a03674995526f2c1dd80d84315b3a338f17c6d6f8b4ecb1078a8f32c798c23a1bcf71ae462f9b1bb403e8dda30dade22e50a30215186325ef522f422ceb876a3e4e4d67421ac5a20b5b9b58ce08f8dd779c9f50de231c8f73957f165c7f5882ed1e6c6f1584dc937aab837261f4753ca3103eac52210b9ae50cb40cfbda77197d622b3a6b51e1189e22fe8c6f1b675915a16a1e94c04e260240b32d17e617ea590336c8ac0c89067fa339ca87718be2a4dba1fe22944913b73b60617f5fccba366db61bb0b82fab4cce34a167e38bc8cefe6274b40b6730a701fcfd88b5f98b3eb492eefbf8d2a62a58f667dd5f1b8dd58a9220c3b73ed529be30a8f1af7e4b81d5e49852fd096cf464bcda3ba362f3daee62ea4d23fa67a15160a624cd29a926cd28205d804002ffa136607e6126d725d597ec258c88ececd317804513170a91cc51125deb38f9a426b8561af57d6cc3b8d3b782c7cecc35fa8d28565b80ba822e36c351b939e642591be8d56179bfe40c8effd8035649e940b3b173df218bee041ed886e1b7826b4980fb744326b3eaac6f96a17269df95c0afcf0134a8be5ac7b13d51fa47323e284c7b4f28706e6437673092a8e90ea1925d728e94dd8c0e79505543ffe3857ffdda814bf6126ff8d7409d4f1b4b39503da83e05730dd35195f0a326726b7386e7def3a88d6646e033fa79fb113f7b03c42b1fa0fe102c8c27ff2c104d1eb65c5f1b86e61c1df7750adef9cc9691c1f7af9f6cea1e19cf81d5e24ea56bbfe596f05c5598dd3ed69f638063327d201612176b8c82114f83883556d9accce0ad2503d5652cfd09133a99853382c6cdab9315a8b20f9960d6165ac72f89dd30200e51db4a8f01620a92cf8d329d180fac89e31e62bd94ea468cc0095d0f4bb94fec8ba37401671c74148817221950e32d8a6013a3cd518808d582055b2699fb0626f5c494de5eee7a33e9722cf33cd58c2ddb9cbfe7eee613612a10378caa0f15c6635cce1e6432d6f23809fb9f1c4bd6000044cbe3464e6d52ddaf036b36dd1d3d3494610834238381ec235a5e7094a986df85f762a7912e6f292d4cf0afce19f3bee6c32183baa7a2869026b0d101598e0fd8131d345dc8e908e20ad20ce4a3baf21067dde374eaf30ca27a67b5881c823f1a46ba4afd6ade41fc8fc4cbdcac513d9af80a63c9aef53e7959e08f6975e4c5410bbe675533333ed9fa365565d7b067703136c63e0e0c5ae17574c68caea54cdf0b429b0c6b4c4d295eaf084bd065ae533c6e6e6f2daeb344e89cbba563ff9843c4615f6544ec1bd1a1857596228157d528624585eb20ed02c0ec403c690a53f624dad18bb83900677ce66b21f5ad6b34dbc971a9040baab258ba715a248cf6b495d3849c39e637cd140d3bc382b72a761bb596d42184b03ef2cb16cbb91a37526aebae38082d9389c84c387db71f813381ec7354f2c4555e02dc9d316233f828fe0581cbaaab9d2dc33023ae9df89f578de04fdfedfb40ca32d76a29ae7cc99be6b51dada5728535b61dabf7b16ffbbfe7186641bc4b5b3ab1e09155dc75a8d426aa14d30228a9d02dce593c6c9ec19332db989be53dcaf21264bcc0653192b632759ffe5f4f410e369c2d4ac7001ab16f74118765f8acaf7e47f72541bf2b9f5459f8c2c161a4ba473cc20cd1e9934dbcfd5e29fd52051650c4e295335766f23d3ea2e39aa340e14c33432bdb24539de7ea4cfe94e0faceff724737e8bf7cfb01603b8f45d80e6278146afd543e4207df814d01956d9990243b746531e91447ff64c108eb98c76e296809596e509ac5a7101c17507af26d79e24776ce3ab59fd599c5371db51b3234532192a5776f4832afa15bbb2351d656fbec6ba7888c744a7a73a15ade28db7c60fe74674019eb6aa76ced6b4226fb2154d8195112dd3a9aa53069488ccf9052c31482cda658aa606a2b1fa86712870db523db37ec1b7b23b6d16fdaf0712ebf800c19a03e96972eb854e3938ccdb07f71dc9d459ea711782cdb4eaa4ea58b3a3f74cbb370aa243fd04fc7deb94c73f042ec7c024b3301b45c303936733b54a7d8f8fe19077bc0718ed1b1cc386fcdf67793e6748d68f9dc90e53d40b4f263f03c4bdcd03939a8af61e3fa65cc9b957c755910558c610523aef0e2d808c121ade0c513b7aaa23ffe7a1364cc107739f09e5754b5ad657fcf249162757f0a15602be524a44ac73f1fcdf75414b64a236b763b82b350b3d3ab6074275204d2f7f56ddd4db84406c4bc5bb149a0f44873d05b5b34826425c616ce0da5362c07bc171b8ff00d8485541b4c756561e8ee711aec593e07e48b43874943791f7a3435ae54d0740c10fdfdef4c51c091646a5e1b705047204d082ee1b634df4fcce951adabd3d2912c3c23cb968645af1140ed34dafe8c8ff04a774acb2541407648b8b87285a9ca4dd8388809afef0fbc31b622aa30ba497bc783657ae47c59be3865feea328382ebb435d46f2874dfa9826625c693ba3f67f475256178f03528178e1624760227627fa5749335a1cf8c192d3a262d3efc655f9e2c88393d4c5c5df0dbfdebbecf5d1b254c75b3038c0a626499a0cfc3be391bba31a8134bb22d23678bab90747f9bd1d593d92da77bd32ea7a8d99abbf3bed13398b32b242e54af1a34ecd2d0f2e204bc09590df4782505ac49277b6efec598b88d4a912aa276d2914b993f7cb6f84b82387195247749a7c417a75165d75d7c550eccccf34fb85ef157167d6b549ed325069625b82e5eef70f20d0f02daf23fa1365364c28574e06406ea188666fd2627c0d25ffcc187c66aae3446160d9741c759e3ddb7885c711464a4f5af05e2a41f66e06dfc9e8684aade4ff59d39dbdb39386af27f196c154c48f31b5622c17ad2cccc203de16961537912d3c1a850464d85607335efba65d106f72411baf1e4c987ada0d6e53ed086c5214e67e004ed099fded2e8fbb64a80d156d3b3d6d7b699b4a55870b6813eb8cad146a60b0ea6cd8b3b4b61f76d8156709e90be7b1a8909925009486fe9b380a6fe896cbb22c58da5300cab8f6f24361f5c8e0dd1ffc91b3edbc955ba1b94acfd9d4641bc45ddb6e10a65427c4e63484307bc07d1c7d00bcab417f7e978e989133a4e07848d47aadf5ec665625924a51866a4b105e44e157be530403cc9a13ca0eca364a254f0677644182a6caf4a1e64b65eb1262db4a88c0f943ce3973942100d50df8c8265727385580b5b74bfc578dd35f87430c589d160edda4c3e361dac2872e35ca8509088a1423b51c2e97d1a41586e0c92a54d8480bc501f56828ae561417cf48996af3c66616740d0da300910c6433f41beae9cd93941581b294c03f1d38e2ff0170670cb53059fe5042ce6888153f6f7d59166f4ea2813e894ab3e1853ba0eef6028d36f76f92d8d93a82944124304f3a971ec55cc9242208ee3b34bcdfe4bc729d331598604738688ed149611121dadaf81bd52f8299ac8c28f7a5312b909f59499f9b782043de48d92d1ec6473e2b9772c4f9b424f611b0998a1e15f6e4e3715ae9e0ac07dfcecfd1cea8a1598c4d41a42f094b129f3107b44794e3dca363382b1fba3a73e2e79a231a05860ee9558418f6bee4bd7e63bd48af7b4acce433f4b1591e3c04bcf02fc10307fe1cf723f5eed1439d5abff30cfc02a05b15b24f68dab35ad8546aa5e65dbc46b28319a4f4a78832236446299ec9c6f269515153fb24ff66b960451eb2803f264da547b4a86d4831a5656b2cd9ad5844c6e69cde53142fdb10f164d2ce02405459635c2e510bb1ceb2ecc704df11cafc3120fee7a2e24734dcd6c4118699d6659f4d1515a957630856969298b457a79858a7268ef6007550de7359eb4cba4d140b6bc4e214cf8bfc1925e91460a1adb44c4ba5e1d048d5f50b2470cd282a70123023e4f89045df38dd5637a4ea8f4d3c22f763d9aec03c417c59fde760a6423aea2fb1db87e0cc2db3a84b01cfdb6d3ea229f636500c42f9aa725166dc6206888dc1d792ca153b8136502e968cfff87c919c065f5998a71a45913e3266a63f44e6667963b138b790929762ea1f0ed847e716350b008d705cbdedfc901543cadd9ba9652589f9e732b0796ff715883e3c02df36d2fa7af4eb573ada8d7b92fefa50ff31bb41baff6aa3935c1f00daad631d19e8294c1837407640a7b00b8066d118323616e5fec9217c6743adb1f9561edaca7ae7ec0d240d2922916757d839e11b93526001aa9f09a0cb823cf3daf8d90e9f334e8146d4c5996df7697a7a16aa3969951a95c774162ce7837c318cd9fc56af8a7a85e6487610a350ce5ef51765a386b3a474692168564338c3911ad04941fcd68be95b58be4a4207744eae9086bf01165277d7d703f0fbe049ab18b0010bb416cd524726102ad99ab30d6875d7054af80d80b4235bdb0e3c0b1a96d503521579878cdf9afc4874407d82dd5f431788ddd11b9e2161d1f10769297e09a736beeec9423e37f04de29e12cc97bd2482000cbcb8e769cf9d3b6bd889f439464495ebb4ff65391aa7539ef69f741a48db69963b6ff0d8b1088631103c65e14251877bca635bb02c1dc2485c0cabc5cc3c1562d2981095d0cb55be066df2ba3153c4fd15e81b40cb9343c19848c0b60c3167e9063fd9b4042b7c2ee1c8f46c9ead81d5c7e35d8e880f51b50ab77e10e4c9eb071bd22f1ad21e2e71f950515582a096ac4075145c7c328653cbde9cdb9401b7587c8a0ecdb9d29543f0f66fa734e9c964e359e50d68c00f07889fcf39bbba7aa54a8dfa8d12457c6a5917560aba92d26710a651d59974c9466e22590289800be31aca248a4cd9eebeec63c3c3cc398c178029e3b9b8a88c4425d17eed3aa3802b332235ad95e4175db34f84d192b6f336edee9f539d8e0b423239bbaa591f09f1a97a33632e509ce34c43fd964109a1c6587e411d029f32f31fe4ee412ace307255cff47d1e94fd1ef229fe65ccdff28c56f4e7ffab4dab8d27eff2a8807efec6ffb9d8005cbe47ac734e54dde1f3d65532265d1b4a4b7141582ba8acfaecdabc6d22906052ef90423829311f964d70aeac5f246c000675317d3f17cd3b9c737c447ded0ad8c1402e2338a882fa1dad8b25aeb97edf78a364924d12807f7ec7db77ceb75fccfd8dc2ede59469002df426ffb52acd9f26aa4b72dc92c0e14c978fa7fb423ee3be16a7bddbd5cc90e82b98df89974df341330dc4f1990b7e7568d86abff87880ba9d001bc98222b857ce998c373f72e55bd9739cb8f5cdc95ae2852f5d4e9c1c21c61998ac300f1b2e04fa324377a293cea215e6fd234798168c043d57ded790b3fa13acf2db6d7520b47ad0f57802b2f8ec82409211352f7b72e96324e03b86ef54b34ec907fe950c68b98adfc1532f</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">输入密码，查看文章。</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">这是一篇加密文章，内容可能是个人情感宣泄或者收费技术。如果你非常好奇，请与我联系。</summary>
    
    
    
    <category term="技术积累记录" scheme="http://example.com/categories/%E6%8A%80%E6%9C%AF%E7%A7%AF%E7%B4%AF%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="加速github博客访问" scheme="http://example.com/tags/%E5%8A%A0%E9%80%9Fgithub%E5%8D%9A%E5%AE%A2%E8%AE%BF%E9%97%AE/"/>
    
  </entry>
  
  <entry>
    <title>2.外部中断(EXTI)</title>
    <link href="http://example.com/post/eb0bc4a3.html"/>
    <id>http://example.com/post/eb0bc4a3.html</id>
    <published>2024-08-03T09:21:42.000Z</published>
    <updated>2024-08-10T06:55:30.916Z</updated>
    
    <content type="html"><![CDATA[<h1 id="理论"><a href="#理论" class="headerlink" title="理论"></a><center>理论</center></h1><p>NVIC：嵌套向量中断控制器（<a href="https://blog.csdn.net/m0_74761015/article/details/136269042">解释教程</a>）</p><p>外部通用中断线(<code>EXTI0~EXTI15</code>)：每个GPIO设置成中断模式，与中断控制器连接的线</p><h2 id="外部中断触发方式"><a href="#外部中断触发方式" class="headerlink" title="外部中断触发方式"></a><center>外部中断触发方式</center></h2><p>上升沿触发、下降沿触发、双边沿触发</p><h2 id="外部中断触发函数"><a href="#外部中断触发函数" class="headerlink" title="外部中断触发函数"></a><center>外部中断触发函数</center></h2><p>在stm32f1xx_it.c文件里(大概204行)</p><table><thead><tr><th align="center">中断触发函数</th></tr></thead><tbody><tr><td align="center">EXTI0_IRQHandler</td></tr><tr><td align="center">EXTI1_IRQHandler</td></tr><tr><td align="center">EXTI2_IRQHandler</td></tr><tr><td align="center">EXTI3_IRQHandler</td></tr><tr><td align="center">EXTI4_IRQHandler</td></tr><tr><td align="center">EXTI9_5_IRQHandler</td></tr><tr><td align="center">EXTI15_10_IRQHandler</td></tr></tbody></table><h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a><center>解析</center></h2><p>解析初始化中断过程</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">//gpio.c中58</span></span><br><span class="line">  <span class="comment">/*Configure GPIO pins : PEPin PEPin */</span></span><br><span class="line">  GPIO_InitStruct.Pin = EXTI_Key1_Pin|EXTI_Key2_Pin;</span><br><span class="line">  GPIO_InitStruct.Mode = GPIO_MODE_IT_FALLING;</span><br><span class="line">  GPIO_InitStruct.Pull = GPIO_PULLUP;</span><br><span class="line">  HAL_GPIO_Init(GPIOE, &amp;GPIO_InitStruct);<span class="comment">//将上面三行代码的数据传入这个函数解析初始化</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//stm32f1xx_hal_gpio.c中286</span></span><br><span class="line"><span class="comment">/*--------------------- EXTI Mode Configuration ------------------------*/</span></span><br><span class="line"><span class="comment">/* Configure the External Interrupt or event for the current IO */</span></span><br><span class="line"><span class="keyword">if</span> ((GPIO_Init-&gt;Mode &amp; EXTI_MODE) == EXTI_MODE)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* Enable AFIO Clock */</span></span><br><span class="line">__HAL_RCC_AFIO_CLK_ENABLE();<span class="comment">//打开复用时钟</span></span><br><span class="line">temp = AFIO-&gt;EXTICR[position &gt;&gt; <span class="number">2u</span>];</span><br><span class="line">CLEAR_BIT(temp, (<span class="number">0x0F</span>u) &lt;&lt; (<span class="number">4u</span> * (position &amp; <span class="number">0x03</span>u)));</span><br><span class="line">SET_BIT(temp, (GPIO_GET_INDEX(GPIOx)) &lt;&lt; (<span class="number">4u</span> * (position &amp; <span class="number">0x03</span>u)));</span><br><span class="line">AFIO-&gt;EXTICR[position &gt;&gt; <span class="number">2u</span>] = temp;<span class="comment">//把固定引脚设置成复用模式(如复用成外部中断)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//配置上升沿还是下降沿</span></span><br><span class="line"><span class="comment">/* Enable or disable the rising trigger */</span></span><br><span class="line"><span class="keyword">if</span> ((GPIO_Init-&gt;Mode &amp; RISING_EDGE) == RISING_EDGE)</span><br><span class="line">&#123;</span><br><span class="line">  SET_BIT(EXTI-&gt;RTSR, iocurrent);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  CLEAR_BIT(EXTI-&gt;RTSR, iocurrent);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Enable or disable the falling trigger */</span></span><br><span class="line"><span class="keyword">if</span> ((GPIO_Init-&gt;Mode &amp; FALLING_EDGE) == FALLING_EDGE)</span><br><span class="line">&#123;</span><br><span class="line">  SET_BIT(EXTI-&gt;FTSR, iocurrent);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  CLEAR_BIT(EXTI-&gt;FTSR, iocurrent);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Configure the event mask */</span></span><br><span class="line"><span class="keyword">if</span> ((GPIO_Init-&gt;Mode &amp; GPIO_MODE_EVT) == GPIO_MODE_EVT)</span><br><span class="line">&#123;</span><br><span class="line">  SET_BIT(EXTI-&gt;EMR, iocurrent);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  CLEAR_BIT(EXTI-&gt;EMR, iocurrent);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//打开或关闭中断</span></span><br><span class="line"><span class="comment">/* Configure the interrupt mask */</span></span><br><span class="line"><span class="keyword">if</span> ((GPIO_Init-&gt;Mode &amp; GPIO_MODE_IT) == GPIO_MODE_IT)</span><br><span class="line">&#123;</span><br><span class="line">  SET_BIT(EXTI-&gt;IMR, iocurrent);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  CLEAR_BIT(EXTI-&gt;IMR, iocurrent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>中断实现过程</strong></p><ol><li>确认中断</li><li>清除中断标志位</li><li>执行中断回调函数</li></ol><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408041510330.png" alt="图示" style="zoom:50%;"><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//stm32f1xx_it.：大概204行</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">EXTI3_IRQHandler</span><span class="params">(<span class="type">void</span>)</span><span class="comment">//中断入口函数</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* USER CODE BEGIN EXTI3_IRQn 0 */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE END EXTI3_IRQn 0 */</span></span><br><span class="line">  HAL_GPIO_EXTI_IRQHandler(EXTI_Key1_Pin);<span class="comment">//在库函数不能写</span></span><br><span class="line">  <span class="comment">/* USER CODE BEGIN EXTI3_IRQn 1 */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE END EXTI3_IRQn 1 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">HAL_GPIO_EXTI_IRQHandler</span><span class="params">(<span class="type">uint16_t</span> GPIO_Pin)</span><span class="comment">//stm32f1xx_hal_gpio.c：大概546行</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* EXTI line interrupt detected */</span></span><br><span class="line">  <span class="keyword">if</span> (__HAL_GPIO_EXTI_GET_IT(GPIO_Pin) != <span class="number">0x00</span>u)<span class="comment">//判断有没有中断触发(有:1,没:0)</span></span><br><span class="line">  &#123;</span><br><span class="line">    __HAL_GPIO_EXTI_CLEAR_IT(GPIO_Pin);<span class="comment">//若进来则为1，为1则清除中断标志位</span></span><br><span class="line">    HAL_GPIO_EXTI_Callback(GPIO_Pin);<span class="comment">//回调函数(Callback)，执行函数</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//stm32f1xx_hal_gpio.h中190</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __HAL_GPIO_EXTI_GET_IT(__EXTI_LINE__) (EXTI-&gt;PR &amp; (__EXTI_LINE__))<span class="comment">//挂起寄存器(EXTI_PR)(参考手册140) 有没有中断触发</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//stm32f1xx_hal_gpio.h中198</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __HAL_GPIO_EXTI_CLEAR_IT(__EXTI_LINE__) (EXTI-&gt;PR = (__EXTI_LINE__))<span class="comment">//赋值，(参考手册140)</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//调用这个函数，__weak：弱声明，若别文件也有相同的函数，优先调用没有弱声明</span></span><br><span class="line">__weak <span class="type">void</span> <span class="title function_">HAL_GPIO_EXTI_Callback</span><span class="params">(<span class="type">uint16_t</span> GPIO_Pin)</span><span class="comment">//stm32f1xx_hal_gpio.c：大概561行</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* Prevent unused argument(s) compilation warning */</span></span><br><span class="line">  UNUSED(GPIO_Pin);</span><br><span class="line">  <span class="comment">/* <span class="doctag">NOTE:</span> This function Should not be modified, when the callback is needed,</span></span><br><span class="line"><span class="comment">           the HAL_GPIO_EXTI_Callback could be implemented in the user file</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>若相同有一个PA0设置了中断，别的PB0等等都不能设置成中断</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408041510079.png" alt="解析图" style="zoom:50%;"><h1 id="代码编写"><a href="#代码编写" class="headerlink" title="代码编写"></a><center>代码编写</center></h1><p>实验：按键PE3控制蜂鸣器(PB8)、按键PE4控制LED灯(PB5)</p><h2 id="LED灯、蜂鸣器、按键配置"><a href="#LED灯、蜂鸣器、按键配置" class="headerlink" title="LED灯、蜂鸣器、按键配置"></a><center>LED灯、蜂鸣器、按键配置</center></h2><p>LED灯、蜂鸣器配置，上一篇已经说过，<a href="https://d3iiz.top/post/adb202b7.html">地址</a></p><p>按键设置<code>下降沿触发</code>(也可上升沿触发)，GPIO Pull-up&#x2F;Pull-down：设置上拉，空闲状态为高电平</p><p>按键没按下时高电平，按下时有下降沿和上升沿，所以两个触发都可，按键这里是中断触发功能，不是GPIO输入功能</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408041510669.png" alt="按键设置图" style="zoom: 33%;"><p>配置NVIC(嵌套向量中断控制器)</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408041512291.png" alt="配置NVIC" style="zoom: 50%;"><p>调节不同中断优先级(数字越小优先级越高)</p><p>若抢占优先级相同，比较子优先级</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408041510564.png" alt="中断优先级" style="zoom:33%;"><p>调节多少bit对应代码在：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HAL_Init();<span class="comment">//main.c(74)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//HAL_StatusTypeDef HAL_Init(void)中的</span></span><br><span class="line">HAL_NVIC_SetPriorityGrouping(NVIC_PRIORITYGROUP_4);<span class="comment">//stm32f1xx_hal.c(157)</span></span><br></pre></td></tr></table></figure><h2 id="Cube-IDE代码"><a href="#Cube-IDE代码" class="headerlink" title="Cube IDE代码"></a><center>Cube IDE代码</center></h2><p>main.c：144行（在mian函数外任意一个 &#x2F;* USER CODE BEGIN  <em>&#x2F;  &#x2F;</em> USER CODE END  *&#x2F;中）</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">HAL_GPIO_EXTI_Callback</span><span class="params">(<span class="type">uint16_t</span> GPIO_Pin)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//若需要延时需要将延时中断优先级比外部中断优先级高，优先级高才可以打断低优先级</span></span><br><span class="line">HAL_Delay(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">if</span>(HAL_GPIO_ReadPin(EXTI_Key1_GPIO_Port, EXTI_Key1_Pin) == <span class="number">0</span>)<span class="comment">//读引脚，相同=0,不同=1</span></span><br><span class="line">&#123;</span><br><span class="line">HAL_GPIO_TogglePin(BEEP_GPIO_Port, BEEP_Pin);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(HAL_GPIO_ReadPin(EXTI_Key2_GPIO_Port, EXTI_Key2_Pin) == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">HAL_GPIO_TogglePin(LED1_GPIO_Port, LED1_Pin);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>中断处理程序要少用延时的原因<br>中断处理的要求是即时处理，尽快退出。如果在中断中使用延时函数或者使用IO阻塞函数，会影响到系统的实时性。如果下次中断来临，延时或者阻塞还没结束，那么就永远在中断里死循环了。<br>因此，对于中断处理程序的要求是：<br>&ensp;&ensp;&ensp;&ensp;短小精悍，不要处理过多任务<br>&ensp;&ensp;&ensp;&ensp;不使用延时函数或者IO阻塞的函数</p></blockquote><h2 id="Keil代码"><a href="#Keil代码" class="headerlink" title="Keil代码"></a><center>Keil代码</center></h2><p>需要修改的地方如下：</p><p>mian.c(144)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">HAL_GPIO_EXTI_Callback</span><span class="params">(<span class="type">uint16_t</span> GPIO_Pin)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//若需要延时需要将延时中断优先级比外部中断优先级高，优先级高才可以打断低优先级</span></span><br><span class="line">HAL_Delay(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">if</span>(HAL_GPIO_ReadPin(EXTI_Key1_GPIO_Port, EXTI_Key1_Pin) == <span class="number">0</span>)<span class="comment">//读引脚，相同=0,不同=1</span></span><br><span class="line">&#123;</span><br><span class="line">HAL_GPIO_TogglePin(BEEP_GPIO_Port, BEEP_Pin);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(HAL_GPIO_ReadPin(EXTI_Key2_GPIO_Port, EXTI_Key2_Pin) == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">HAL_GPIO_TogglePin(LED1_GPIO_Port, LED1_Pin);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>main.h(60)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> EXTI_Key1_Pin GPIO_PIN_3</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXTI_Key1_GPIO_Port GPIOE</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXTI_Key1_EXTI_IRQn EXTI3_IRQn</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXTI_Key2_Pin GPIO_PIN_4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXTI_Key2_GPIO_Port GPIOE</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXTI_Key2_EXTI_IRQn EXTI4_IRQn</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LED1_Pin GPIO_PIN_5</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LED1_GPIO_Port GPIOB</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BEEP_Pin GPIO_PIN_8</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BEEP_GPIO_Port GPIOB</span></span><br></pre></td></tr></table></figure><p>gpio.c(42)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">MX_GPIO_Init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  GPIO_InitTypeDef GPIO_InitStruct = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* GPIO Ports Clock Enable */</span></span><br><span class="line">  __HAL_RCC_GPIOE_CLK_ENABLE();</span><br><span class="line">  __HAL_RCC_GPIOA_CLK_ENABLE();</span><br><span class="line">  __HAL_RCC_GPIOB_CLK_ENABLE();</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*Configure GPIO pin Output Level */</span></span><br><span class="line">  HAL_GPIO_WritePin(LED1_GPIO_Port, LED1_Pin, GPIO_PIN_SET);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*Configure GPIO pin Output Level */</span></span><br><span class="line">  HAL_GPIO_WritePin(BEEP_GPIO_Port, BEEP_Pin, GPIO_PIN_RESET);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*Configure GPIO pins : PEPin PEPin */</span></span><br><span class="line">  GPIO_InitStruct.Pin = EXTI_Key1_Pin|EXTI_Key2_Pin;</span><br><span class="line">  GPIO_InitStruct.Mode = GPIO_MODE_IT_FALLING;</span><br><span class="line">  GPIO_InitStruct.Pull = GPIO_PULLUP;</span><br><span class="line">  HAL_GPIO_Init(GPIOE, &amp;GPIO_InitStruct);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*Configure GPIO pins : PBPin PBPin */</span></span><br><span class="line">  GPIO_InitStruct.Pin = LED1_Pin|BEEP_Pin;</span><br><span class="line">  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;</span><br><span class="line">  GPIO_InitStruct.Pull = GPIO_NOPULL;</span><br><span class="line">  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;</span><br><span class="line">  HAL_GPIO_Init(GPIOB, &amp;GPIO_InitStruct);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* EXTI interrupt init*/</span></span><br><span class="line">  HAL_NVIC_SetPriority(EXTI3_IRQn, <span class="number">5</span>, <span class="number">0</span>);</span><br><span class="line">  HAL_NVIC_EnableIRQ(EXTI3_IRQn);</span><br><span class="line"></span><br><span class="line">  HAL_NVIC_SetPriority(EXTI4_IRQn, <span class="number">5</span>, <span class="number">0</span>);</span><br><span class="line">  HAL_NVIC_EnableIRQ(EXTI4_IRQn);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>stm32f1xx_hal_it.c(204)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">EXTI3_IRQHandler</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* USER CODE BEGIN EXTI3_IRQn 0 */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE END EXTI3_IRQn 0 */</span></span><br><span class="line">  HAL_GPIO_EXTI_IRQHandler(EXTI_Key1_Pin);</span><br><span class="line">  <span class="comment">/* USER CODE BEGIN EXTI3_IRQn 1 */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE END EXTI3_IRQn 1 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">EXTI4_IRQHandler</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* USER CODE BEGIN EXTI4_IRQn 0 */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE END EXTI4_IRQn 0 */</span></span><br><span class="line">  HAL_GPIO_EXTI_IRQHandler(EXTI_Key2_Pin);</span><br><span class="line">  <span class="comment">/* USER CODE BEGIN EXTI4_IRQn 1 */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE END EXTI4_IRQn 1 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改延时中断优先级</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HAL_Init();<span class="comment">//main.c(74)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//HAL_StatusTypeDef HAL_Init(void)中的</span></span><br><span class="line">HAL_InitTick(TICK_INT_PRIORITY);<span class="comment">//stm32f1xx_hal.c(160)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//进入参数里修改</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>  TICK_INT_PRIORITY            1U<span class="comment">//stm32f1xx_hal_conf.h(132)</span></span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;理论&quot;&gt;&lt;a href=&quot;#理论&quot; class=&quot;headerlink&quot; title=&quot;理论&quot;&gt;&lt;/a&gt;&lt;center&gt;理论&lt;/center&gt;&lt;/h1&gt;&lt;p&gt;NVIC：嵌套向量中断控制器（&lt;a href=&quot;https://blog.csdn.net/m0_7476</summary>
      
    
    
    
    <category term="32单片机" scheme="http://example.com/categories/32%E5%8D%95%E7%89%87%E6%9C%BA/"/>
    
    
    <category term="32单片机" scheme="http://example.com/tags/32%E5%8D%95%E7%89%87%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>ST-LINK未能串口keil识别的一个可能解决方案（前提驱动安装无问题）</title>
    <link href="http://example.com/post/a3ad0b3a.html"/>
    <id>http://example.com/post/a3ad0b3a.html</id>
    <published>2024-08-03T08:56:06.000Z</published>
    <updated>2024-08-03T09:38:00.406Z</updated>
    
    <content type="html"><![CDATA[<p>打开这个软件，在点击清除之前，按住单片机复位按钮不放，点击清除按钮，等待3-5秒放开复位按钮，即可清除重置，若提示没识别到，多重复几次，即可重置，重置完成之后再回到烧写软件，即可烧写成功</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408031657478.png" alt="软件图" style="zoom:50%;"><p>在烧写时提示烧写成功后会显示如图所示</p><p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408031658168.png" alt="错误提示图"></p><p>解决方法：可能某个地方设置错误，我这里是这个没有设置成 Serial Wire，可以把全部设置重新检查一遍</p><p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408031657360.png" alt="方法图"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;打开这个软件，在点击清除之前，按住单片机复位按钮不放，点击清除按钮，等待3-5秒放开复位按钮，即可清除重置，若提示没识别到，多重复几次，即可重置，重置完成之后再回到烧写软件，即可烧写成功&lt;/p&gt;
&lt;img src=&quot;https://cdn.d3iiz.top/gh/xinz</summary>
      
    
    
    
    <category term="技术积累记录" scheme="http://example.com/categories/%E6%8A%80%E6%9C%AF%E7%A7%AF%E7%B4%AF%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="ST-LINK未能串口keil识别解决方案" scheme="http://example.com/tags/ST-LINK%E6%9C%AA%E8%83%BD%E4%B8%B2%E5%8F%A3keil%E8%AF%86%E5%88%AB%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    
  </entry>
  
  <entry>
    <title>STM32CubeIDE代码字体大小</title>
    <link href="http://example.com/post/43a9b762.html"/>
    <id>http://example.com/post/43a9b762.html</id>
    <published>2024-08-03T08:52:40.000Z</published>
    <updated>2024-08-03T09:38:00.406Z</updated>
    
    <content type="html"><![CDATA[<p> 进入首选项设置</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408031654048.png" alt="img" style="zoom:50%;"><p>搜索editor，按照图中标号，进行设置</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408031654274.png" alt="img" style="zoom:50%;"><p>按图中标号进行设置，选择需要的字号</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408031654824.png" alt="img" style="zoom:50%;"><p>到此设置完成</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt; 进入首选项设置&lt;/p&gt;
&lt;img src=&quot;https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408031654048.png&quot; alt=&quot;img&quot; style=&quot;zoom:50%;&quot;&gt;

&lt;p&gt;搜索editor，按照图中标号</summary>
      
    
    
    
    <category term="技术积累记录" scheme="http://example.com/categories/%E6%8A%80%E6%9C%AF%E7%A7%AF%E7%B4%AF%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="STM32CubeIDE代码字体大小" scheme="http://example.com/tags/STM32CubeIDE%E4%BB%A3%E7%A0%81%E5%AD%97%E4%BD%93%E5%A4%A7%E5%B0%8F/"/>
    
  </entry>
  
  <entry>
    <title>DHT11dht11.c(18) error C174 return-expression on void-function</title>
    <link href="http://example.com/post/c4236caa.html"/>
    <id>http://example.com/post/c4236caa.html</id>
    <published>2024-08-03T08:46:17.000Z</published>
    <updated>2024-08-03T09:38:00.406Z</updated>
    
    <content type="html"><![CDATA[<p>表示在函数dht11.c的第18行，有一个返回表达式出现在了一个返回类型为void的函数中。在C语言中，如果一个函数的声明或定义中指定了返回类型为void，那么这个函数不能有任何返回值。</p><p>​    要解决这个问题，你需要检查dht11.c文件中第18行的代码，确保没有返回值。如果该行代码确实需要返回一个值，那么你需要将该函数的返回类型修改为非void类型</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;表示在函数dht11.c的第18行，有一个返回表达式出现在了一个返回类型为void的函数中。在C语言中，如果一个函数的声明或定义中指定了返回类型为void，那么这个函数不能有任何返回值。&lt;/p&gt;
&lt;p&gt;​    要解决这个问题，你需要检查dht11.c文件中第18行的代码，</summary>
      
    
    
    
    <category term="错误记录" scheme="http://example.com/categories/%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95/"/>
    
    
  </entry>
  
  <entry>
    <title>STM32烧录的时候报错：Error :Flash Download failed -“Cortex-M3“</title>
    <link href="http://example.com/post/63d3dd68.html"/>
    <id>http://example.com/post/63d3dd68.html</id>
    <published>2024-08-03T08:46:17.000Z</published>
    <updated>2024-08-03T09:38:00.406Z</updated>
    
    <content type="html"><![CDATA[<p> 点击图中标号1，按顺序点击进入设置</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408031700928.png" alt="img" style="zoom:50%;"><p>按图中标序，进入添加页面</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408031700487.png" alt="img" style="zoom:50%;"><p>添加图中所选，然后一直确定退出即可，若没有图中所示选项，可能软件没下载对</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408031700644.png" alt="img" style="zoom:50%;"><p>添加后，即可烧录成功。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt; 点击图中标号1，按顺序点击进入设置&lt;/p&gt;
&lt;img src=&quot;https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408031700928.png&quot; alt=&quot;img&quot; style=&quot;zoom:50%;&quot;&gt;

&lt;p&gt;按图中标序</summary>
      
    
    
    
    <category term="错误记录" scheme="http://example.com/categories/%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95/"/>
    
    
  </entry>
  
  <entry>
    <title>stm32cubeIDE与stm32cubeMX库文件安装路径自定义设置</title>
    <link href="http://example.com/post/32e9e993.html"/>
    <id>http://example.com/post/32e9e993.html</id>
    <published>2024-08-03T08:44:26.000Z</published>
    <updated>2024-08-03T09:38:00.406Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1、-stm32cubeMX库文件安装路径自定义设置"><a href="#1、-stm32cubeMX库文件安装路径自定义设置" class="headerlink" title="1、 stm32cubeMX库文件安装路径自定义设置"></a>1、 stm32cubeMX库文件安装路径自定义设置</h1><p>打开stm32cubeMX软件，依次点击标题栏【Help】→【Updater Settings】 </p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408031651690.png" alt="img" style="zoom:33%;"><hr><p>点击图中的【Browser】，选择自己想要存放库文件的文件夹，选择完成后点击【OK】即可设置成功。 </p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408031649589.png" alt="img" style="zoom:33%;"><p> PS：这里的路径建议选择软件的安装目录</p><h1 id="2、-stm32cubeIDE库安装路径自定义设置"><a href="#2、-stm32cubeIDE库安装路径自定义设置" class="headerlink" title="2、 stm32cubeIDE库安装路径自定义设置"></a>2、 stm32cubeIDE库安装路径自定义设置</h1><p>首先打开 stm32cubeIDE软件，然后依次点击【Window】→【Preference】</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408031649667.png" alt="img" style="zoom: 50%;"><hr><p> 依次点击左侧【STM32Cube】→【Firmware Updater】，点击上图中的【Browser】，选择自己想要存放库文件的文件夹，选择完成后点击【Apply and Close】即可设置成功</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408031650943.png" alt="img" style="zoom: 33%;"><p>PS：stm32cubeIDE与stm32cubeMX的库文件是通用的，也可以直接选择了stm32cubeMX的库文件路径，这样stm32cubeIDE就可以自动识别文件夹中已有的库文件，避免库文件重复下载，节省了内存。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;1、-stm32cubeMX库文件安装路径自定义设置&quot;&gt;&lt;a href=&quot;#1、-stm32cubeMX库文件安装路径自定义设置&quot; class=&quot;headerlink&quot; title=&quot;1、 stm32cubeMX库文件安装路径自定义设置&quot;&gt;&lt;/a&gt;1、 stm32</summary>
      
    
    
    
    <category term="技术积累记录" scheme="http://example.com/categories/%E6%8A%80%E6%9C%AF%E7%A7%AF%E7%B4%AF%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="IDE与MX库文件安装路径自定义设置" scheme="http://example.com/tags/IDE%E4%B8%8EMX%E5%BA%93%E6%96%87%E4%BB%B6%E5%AE%89%E8%A3%85%E8%B7%AF%E5%BE%84%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AE%BE%E7%BD%AE/"/>
    
  </entry>
  
  <entry>
    <title>新电脑 个人博客迁移</title>
    <link href="http://example.com/post/362c3b0.html"/>
    <id>http://example.com/post/362c3b0.html</id>
    <published>2024-08-03T08:29:18.000Z</published>
    <updated>2024-08-03T09:38:00.406Z</updated>
    
    <content type="html"><![CDATA[<h1 id="安装和配置所需要的软件"><a href="#安装和配置所需要的软件" class="headerlink" title="安装和配置所需要的软件"></a><center>安装和配置所需要的软件</center></h1><p>安装Git 客户端，安装过程省略，一般默认下一步</p><p>​    下载地址：<a href="https://git-scm.com/downloads">Git客户端</a></p><p>​    这个无脑下一步即可无需配置</p><p>安装node JS，安装过程省略，一般默认下一步</p><p>​    下载地址：<a href="https://nodejs.cn/download/">node JS</a></p><p>​    配置看这位大佬教程：<a href="https://blog.csdn.net/qq_38514863/article/details/123145473">地址</a></p><p>拷贝个人博客文件夹中，部分文件，到新电脑，存放个人博客文件的文件夹中</p><blockquote><p>_config.yml</p><p>package.json</p><p>scaffolds&#x2F;</p><p>source&#x2F;</p><p>themes&#x2F;</p><p>.gitignore    这个图中没标，注意保留</p></blockquote><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408031631634.png" alt="img" style="zoom:33%;"><h1 id="安装hexo"><a href="#安装hexo" class="headerlink" title="安装hexo"></a><center>安装hexo</center></h1><p>在 cmd 下输入下面指令安装 hexo</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-cli -g</span><br></pre></td></tr></table></figure><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408031631749.png" alt="img" style="zoom:50%;"><h1 id="配置博客"><a href="#配置博客" class="headerlink" title="配置博客"></a><center>配置博客</center></h1><p>进入 F:&#x2F;Blog 目录（你拷贝到新电脑的目录），右键git，输入下面指令安装相关模块</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// “ ”内换成自己对应的</span><br><span class="line">git config --global user.name &quot;HuGen&quot;</span><br><span class="line">git config --global user.email &quot;LoveHuGen@126q.com&quot;</span><br><span class="line">ssh-keygen -t rsa -C &quot;LoveHuGen@126q.com&quot;</span><br></pre></td></tr></table></figure><p>Github 添加 SSH Keys</p><p>1、在本地创建 <code>SSH Keys</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;wujiajiansh@163.com&quot;</span><br><span class="line">//一直回车，直到结束</span><br></pre></td></tr></table></figure><p>2、复制key</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408031629005.png" alt="img" style="zoom:50%;"><p>进入登录GitHub，在设置中添加ssh key</p><img src="https://i-blog.csdnimg.cn/blog_migrate/3431a3fd067aaa03d8860c1652da41c9.png" alt="img" style="zoom: 33%;"><p>将上一步中的文件里面的内容全部复制进去 ，点击添加</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408031629211.png" alt="img" style="zoom:33%;"><h1 id="部署博客"><a href="#部署博客" class="headerlink" title="部署博客"></a><center>部署博客</center></h1><p>打开电脑的：Windows PowerShell 进入博客目录</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br><span class="line">npm install hexo-deployer-git --save  // 文章部署到 git 的模块</span><br><span class="line">（下面为选择安装）</span><br><span class="line">npm install hexo-generator-feed --save  // 建立 RSS 订阅</span><br><span class="line">npm install hexo-generator-sitemap --save // 建立站点地图</span><br></pre></td></tr></table></figure><p>依次命令安装 </p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408031629186.png" alt="img" style="zoom: 50%;"><p>全部安装完成之后，一键三连部署上传</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo cl &amp;&amp; hexo g  &amp;&amp; hexo d</span><br></pre></td></tr></table></figure><p>到此全部完成，感谢观看！！！ </p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;安装和配置所需要的软件&quot;&gt;&lt;a href=&quot;#安装和配置所需要的软件&quot; class=&quot;headerlink&quot; title=&quot;安装和配置所需要的软件&quot;&gt;&lt;/a&gt;&lt;center&gt;安装和配置所需要的软件&lt;/center&gt;&lt;/h1&gt;&lt;p&gt;安装Git 客户端，安装过程省略，</summary>
      
    
    
    
    <category term="技术积累记录" scheme="http://example.com/categories/%E6%8A%80%E6%9C%AF%E7%A7%AF%E7%B4%AF%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="个人博客迁移" scheme="http://example.com/tags/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E8%BF%81%E7%A7%BB/"/>
    
  </entry>
  
  <entry>
    <title>1.GPIO</title>
    <link href="http://example.com/post/adb202b7.html"/>
    <id>http://example.com/post/adb202b7.html</id>
    <published>2024-08-02T07:47:03.000Z</published>
    <updated>2024-08-10T06:55:37.157Z</updated>
    
    <content type="html"><![CDATA[<h1 id="理论说明"><a href="#理论说明" class="headerlink" title="理论说明"></a><center>理论说明</center></h1><h2 id="输入"><a href="#输入" class="headerlink" title="输入"></a><center>输入</center></h2><p>上拉输入：拉高电平</p><p>下拉输入：拉低电平</p><p>浮空输入：不拉高也不拉低电平</p><h2 id="输出"><a href="#输出" class="headerlink" title="输出"></a><center>输出</center></h2><p>开漏输出：不能输出高电平（P-MOS不可用，则只能低电平）</p><p>推挽输出：可输出高低电平</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022058509.png" alt="输入输出电路图" style="zoom:33%;"><p>输出速率</p><ul><li>Low：2MHz</li><li>Medium：10MHz</li><li>High：50MHz</li></ul><h1 id="代码编写"><a href="#代码编写" class="headerlink" title="代码编写"></a><center>代码编写</center></h1><p>LED灯闪烁、按键PE3控制蜂鸣器(PB8)开关、按键PE4控制 LED2(PE5) 亮灭、光敏传感器(PB11)控制 LED1(PB5) 亮灭</p><h2 id="实验一：LED灯闪烁"><a href="#实验一：LED灯闪烁" class="headerlink" title="实验一：LED灯闪烁"></a><center>实验一：LED灯闪烁</center></h2><h3 id="LED灯配置"><a href="#LED灯配置" class="headerlink" title="LED灯配置"></a><center>LED灯配置</center></h3><p>配置引脚功能：</p><p>GPIO Pull-up&#x2F;Pull-down：因为LED灯初始化时就已经设置了高低电平，没有空闲状态，无论是上拉还是下拉都起不到作用</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022058550.png" alt="GPIO配置" style="zoom:33%;"><h3 id="Cube-IDE代码"><a href="#Cube-IDE代码" class="headerlink" title="Cube IDE代码"></a><center>Cube IDE代码</center></h3><p>在main.c文件，大概94行开始，代码必须写在 <code>/* USER CODE BEGIN WHILE */ </code> 和 <code>/* USER CODE END WHILE */</code>里面，否则在图形初始化设置后重新生成会把代码清除</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">/* USER CODE BEGIN WHILE */</span></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//参数1：GPIO口名字(PB)，参数2：GPIO数字(PB5中的5)，参数3：高低电平(0,1)</span></span><br><span class="line">HAL_GPIO_WritePin(LED1_GPIO_Port, LED1_Pin, <span class="number">0</span>);</span><br><span class="line">HAL_Delay(<span class="number">1000</span>);</span><br><span class="line">HAL_GPIO_WritePin(LED1_GPIO_Port, LED1_Pin, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//HAL_GPIO_TogglePin(LED1_GPIO_Port, LED1_Pin);//电平反转,无需设置高低电平</span></span><br><span class="line">HAL_Delay(<span class="number">1000</span>);</span><br><span class="line"><span class="comment">/* USER CODE END WHILE */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* USER CODE BEGIN 3 */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* USER CODE END 3 */</span></span><br></pre></td></tr></table></figure><h2 id="实验二：按键控制蜂鸣器、LED灯"><a href="#实验二：按键控制蜂鸣器、LED灯" class="headerlink" title="实验二：按键控制蜂鸣器、LED灯"></a><center>实验二：按键控制蜂鸣器、LED灯</center></h2><p>按键PE3控制蜂鸣器(PB8)开关、按键PE4控制 LED2(PE5) 亮灭、光敏传感器(PB11)控制 LED1(PB5) 亮灭</p><h3 id="按键、蜂鸣器配置"><a href="#按键、蜂鸣器配置" class="headerlink" title="按键、蜂鸣器配置"></a><center>按键、蜂鸣器配置</center></h3><p>按键：设置成<code>上拉输入</code>，PE4则为高电平，当按键按下时，PE4为0(可用if判断是否按下)，则按键按下(其它按钮同理)</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022058792.png" alt="按键电路图" style="zoom:50%;"><p>LED灯、蜂鸣器(PB8)：输出高低电平，设置<code>推挽输出</code></p><p>光敏传感器(PB11)：高低电平由外界光照强度来决定，设置<code>浮空输入</code></p><p>按键配置：</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022102523.png" alt="按钮配置" style="zoom:33%;"><p>LED灯配置方面已经说明，直接配置</p><p>蜂鸣器配置(PB8)：</p><p>GPIO Pull-up&#x2F;Pull-down：因为蜂鸣器初始化时就已经设置了高低电平，没有空闲状态，无论是上拉还是下拉都起不到作用</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022102449.png" alt="蜂鸣器配置图" style="zoom: 33%;"><p>光敏传感器配置(PB11)：</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022102960.png" alt="光敏传感器配置图" style="zoom:33%;"><p>光敏传感器AO  DO有什么区别？</p><p>AO：输出模拟信号</p><p>DO：输出数字信号（高低电平）</p><h3 id="Cube-IDE代码-1"><a href="#Cube-IDE代码-1" class="headerlink" title="Cube IDE代码"></a><center>Cube IDE代码</center></h3><p>在main.c文件，大概94行开始</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* USER CODE BEGIN WHILE */</span></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span> == HAL_GPIO_ReadPin(Key1_GPIO_Port, Key1_Pin))<span class="comment">//检测读取按键高低电平</span></span><br><span class="line">&#123;</span><br><span class="line">HAL_Delay(<span class="number">120</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span> == HAL_GPIO_ReadPin(Key1_GPIO_Port, Key1_Pin))<span class="comment">//检测读取按键高低电平</span></span><br><span class="line">&#123;</span><br><span class="line">HAL_GPIO_TogglePin(BEEP_GPIO_Port, BEEP_Pin);<span class="comment">//电平反转,无需设置高低电平</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span> == HAL_GPIO_ReadPin(Key2_GPIO_Port, Key2_Pin))<span class="comment">//检测读取按键输入高低电平</span></span><br><span class="line">&#123;</span><br><span class="line">HAL_Delay(<span class="number">120</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span> == HAL_GPIO_ReadPin(Key2_GPIO_Port, Key2_Pin))<span class="comment">//检测读取按键高低电平</span></span><br><span class="line">&#123;</span><br><span class="line">HAL_GPIO_TogglePin(LED2_GPIO_Port, LED2_Pin);<span class="comment">//电平反转,无需设置高低电平</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span> == HAL_GPIO_ReadPin(SUN_GPIO_Port, SUN_Pin))<span class="comment">//检测读取光敏传感器输入高低电平</span></span><br><span class="line">&#123;</span><br><span class="line">HAL_GPIO_WritePin(LED1_GPIO_Port, LED1_Pin, <span class="number">1</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">HAL_GPIO_WritePin(LED1_GPIO_Port, LED1_Pin, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line">   <span class="comment">/* USER CODE END WHILE */</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">/* USER CODE BEGIN 3 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>效果展示：<br>[video(video-8ZdCXtcq-1722497936311)(type-csdn)(url-<a href="https://live.csdn.net/v/embed/414340)(image-https://img-blog.csdnimg.cn/img_convert/1ddf5e3e8fa7bae7111014a6e3b0bfed.jpeg)(title-)]">https://live.csdn.net/v/embed/414340)(image-https://img-blog.csdnimg.cn/img_convert/1ddf5e3e8fa7bae7111014a6e3b0bfed.jpeg)(title-)]</a></p><h3 id="代码过程"><a href="#代码过程" class="headerlink" title="代码过程"></a><center>代码过程</center></h3><p>初始化时钟</p><ol><li>初始化时钟</li></ol><p>APB2ENR：外设时钟使能寄存器</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022058546.png" alt="外设时钟使能寄存器图" style="zoom:50%;"><p>大概功能：将APB2ENR(外设时钟使能寄存器)初始化IO端口B时钟开启</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使能时钟初始化代码，在gpio.c中48行</span></span><br><span class="line">__HAL_RCC_GPIOE_CLK_ENABLE();</span><br><span class="line">__HAL_RCC_GPIOB_CLK_ENABLE();</span><br><span class="line">__HAL_RCC_GPIOA_CLK_ENABLE();</span><br><span class="line"></span><br><span class="line"><span class="comment">//__HAL_RCC_GPIOB_CLK_ENABLE(); 如下过程</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __HAL_RCC_GPIOB_CLK_ENABLE()   do &#123; \</span></span><br><span class="line"><span class="meta"> __IO uint32_t tmpreg;  <span class="comment">/*定义一个变量*/</span>\</span></span><br><span class="line"><span class="meta">SET_BIT(RCC-&gt;APB2ENR, RCC_APB2ENR_IOPBEN);\</span></span><br><span class="line"><span class="meta"><span class="comment">/* Delay after an RCC peripheral clock enabling(下方两个延时作用) */</span>\</span></span><br><span class="line"><span class="meta">tmpreg = READ_BIT(RCC-&gt;APB2ENR, RCC_APB2ENR_IOPBEN);\</span></span><br><span class="line"><span class="meta">UNUSED(tmpreg); \</span></span><br><span class="line"><span class="meta">&#125; while(0U)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//SET_BIT(RCC-&gt;APB2ENR, RCC_APB2ENR_IOPBEN); 的解释</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//1.RCC_APB2ENR_IOPBEN</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RCC_APB2ENR_IOPBEN_Pos(3U)                              </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RCC_APB2ENR_IOPBEN_Msk(0x1UL &lt;&lt; RCC_APB2ENR_IOPBEN_Pos)<span class="comment">/*RCC_APB2ENR_IOPBEN_Msk 等于0x1&lt;&lt; 3 结果：0x00000008 */</span></span></span><br><span class="line"><span class="comment">//0x1 = 0000 0001 &lt;&lt; 3 = 0000 1000(对应上图,位3为1) = 0x00000008 </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RCC_APB2ENR_IOPBENRCC_APB2ENR_IOPBEN_Msk<span class="comment">/* RCC_APB2ENR_IOPBEN 等于0x00000008 */</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//2.RCC寄存器，RCC_BASE强转成这个RCC_TypeDef类型的结构体</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RCC                 ((RCC_TypeDef *)RCC_BASE)</span></span><br><span class="line"><span class="comment">//RCC_BASE = 由总线矩阵偏移到AHB系统总线再偏移到复位和时钟控制(RCC)(可看参考手册的系统结构)(下面三行从下往上看)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RCC_BASE              (AHBPERIPH_BASE + 0x00001000UL)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AHBPERIPH_BASE        (PERIPH_BASE + 0x00020000UL)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PERIPH_BASE           0x40000000UL</span></span><br><span class="line"><span class="comment">//RCC_TypeDef（结构体）</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  __IO <span class="type">uint32_t</span> CR;</span><br><span class="line">  __IO <span class="type">uint32_t</span> CFGR;</span><br><span class="line">  __IO <span class="type">uint32_t</span> CIR;</span><br><span class="line">  __IO <span class="type">uint32_t</span> APB2RSTR;</span><br><span class="line">  __IO <span class="type">uint32_t</span> APB1RSTR;</span><br><span class="line">  __IO <span class="type">uint32_t</span> AHBENR;</span><br><span class="line">  __IO <span class="type">uint32_t</span> APB2ENR;</span><br><span class="line">  __IO <span class="type">uint32_t</span> APB1ENR;</span><br><span class="line">  __IO <span class="type">uint32_t</span> BDCR;</span><br><span class="line">  __IO <span class="type">uint32_t</span> CSR;</span><br><span class="line">&#125; RCC_TypeDef;</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.RCC-&gt;APB2ENR</span></span><br><span class="line">RCC指向APB2ENR，则就是结构体内的__IO <span class="type">uint32_t</span> APB2ENR;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将APB2ENR的位3置1</span></span><br></pre></td></tr></table></figure><ol start="2"><li>初始化引脚</li></ol><p>GPIOx_BSRR：端口位设置&#x2F;清除寄存器</p><p>低16位中若有某一位 置1，则这个引脚为1(高电平)，若都为0，则不影响</p><p>高16位中若有某一位 置1，则这个引脚位0(低电平)，若都为0，则不影响</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022101304.png" alt="端口位设置/清除寄存器图" style="zoom:50%;"><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//gpio.c中第53行</span></span><br><span class="line"><span class="comment">/*Configure GPIO pin Output Level */</span></span><br><span class="line">HAL_GPIO_WritePin(LED2_GPIO_Port, LED2_Pin, GPIO_PIN_SET);</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">HAL_GPIO_WritePin</span><span class="params">(GPIO_TypeDef *GPIOx, <span class="type">uint16_t</span> GPIO_Pin, GPIO_PinState PinState)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* Check the parameters */</span></span><br><span class="line">  assert_param(IS_GPIO_PIN(GPIO_Pin));</span><br><span class="line">  assert_param(IS_GPIO_PIN_ACTION(PinState));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (PinState != GPIO_PIN_RESET)<span class="comment">//GPIO_PIN_RESET为0</span></span><br><span class="line">  &#123;</span><br><span class="line">    GPIOx-&gt;BSRR = GPIO_Pin;<span class="comment">//给BSRR寄存器 低16位赋值 置1</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    GPIOx-&gt;BSRR = (<span class="type">uint32_t</span>)GPIO_Pin &lt;&lt; <span class="number">16u</span>;<span class="comment">//给BSRR寄存器 高16位赋值 置0</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//GPIO_TypeDef *GPIOx 等于 LED2_GPIO_Port</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LED2_GPIO_Port GPIOE</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOE((GPIO_TypeDef *)GPIOE_BASE)</span></span><br><span class="line"><span class="comment">//GPIO_TypeDef 强转</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  __IO <span class="type">uint32_t</span> CRL;</span><br><span class="line">  __IO <span class="type">uint32_t</span> CRH;</span><br><span class="line">  __IO <span class="type">uint32_t</span> IDR;</span><br><span class="line">  __IO <span class="type">uint32_t</span> ODR;</span><br><span class="line">  __IO <span class="type">uint32_t</span> BSRR;</span><br><span class="line">  __IO <span class="type">uint32_t</span> BRR;</span><br><span class="line">  __IO <span class="type">uint32_t</span> LCKR;</span><br><span class="line">&#125; GPIO_TypeDef;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOE_BASE            (APB2PERIPH_BASE + 0x00001800UL)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> APB2PERIPH_BASE       (PERIPH_BASE + 0x00010000UL)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PERIPH_BASE           0x40000000UL</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//GPIO_Pin 等于 LED2_Pin</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LED2_Pin GPIO_PIN_5</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIO_PIN_5((uint16_t)0x0020)  <span class="comment">/* Pin 5 selected    */</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="3"><li>写实际需求（输入：read  判断，输出：write   0&#x2F;1）</li></ol><h2 id="Keil代码"><a href="#Keil代码" class="headerlink" title="Keil代码"></a><center>Keil代码</center></h2><p>代码必须写在 <code>/* USER CODE BEGIN WHILE */ </code> 和 <code>/* USER CODE END WHILE */</code>里面，否则在图形初始化设置后重新生成会把代码清除，若不打算使用图形初始化则可以随便写，修改的地方如下：</p><p>main.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//main函数中</span></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span> == HAL_GPIO_ReadPin(Key1_GPIO_Port, Key1_Pin))<span class="comment">//检测读取按键高低电平</span></span><br><span class="line">&#123;</span><br><span class="line">HAL_Delay(<span class="number">120</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span> == HAL_GPIO_ReadPin(Key1_GPIO_Port, Key1_Pin))<span class="comment">//检测读取按键高低电平</span></span><br><span class="line">&#123;</span><br><span class="line">HAL_GPIO_TogglePin(BEEP_GPIO_Port, BEEP_Pin);<span class="comment">//电平反转,无需设置高低电平</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span> == HAL_GPIO_ReadPin(Key2_GPIO_Port, Key2_Pin))<span class="comment">//检测读取按键输入高低电平</span></span><br><span class="line">&#123;</span><br><span class="line">HAL_Delay(<span class="number">120</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span> == HAL_GPIO_ReadPin(Key2_GPIO_Port, Key2_Pin))<span class="comment">//检测读取按键高低电平</span></span><br><span class="line">&#123;</span><br><span class="line">HAL_GPIO_TogglePin(LED2_GPIO_Port, LED2_Pin);<span class="comment">//电平反转,无需设置高低电平</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="number">0</span> == HAL_GPIO_ReadPin(SUN_GPIO_Port, SUN_Pin))<span class="comment">//检测读取光敏传感器输入高低电平</span></span><br><span class="line">&#123;</span><br><span class="line">HAL_GPIO_WritePin(LED1_GPIO_Port, LED1_Pin, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">HAL_GPIO_WritePin(LED1_GPIO_Port, LED1_Pin, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>gpio.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">MDK_GPIO_Init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">GPIO_InitTypeDef GPIO_InitStruct = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* GPIO Ports Clock Enable */</span></span><br><span class="line">  __HAL_RCC_GPIOE_CLK_ENABLE();</span><br><span class="line">  __HAL_RCC_GPIOB_CLK_ENABLE();</span><br><span class="line">  __HAL_RCC_GPIOA_CLK_ENABLE();</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*Configure GPIO pin Output Level */</span></span><br><span class="line">  HAL_GPIO_WritePin(LED2_GPIO_Port, LED2_Pin, GPIO_PIN_SET);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*Configure GPIO pin Output Level */</span></span><br><span class="line">  HAL_GPIO_WritePin(LED1_GPIO_Port, LED1_Pin, GPIO_PIN_SET);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*Configure GPIO pin Output Level */</span></span><br><span class="line">  HAL_GPIO_WritePin(BEEP_GPIO_Port, BEEP_Pin, GPIO_PIN_RESET);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*Configure GPIO pins : PEPin PEPin */</span></span><br><span class="line">  GPIO_InitStruct.Pin = Key1_Pin|Key2_Pin;</span><br><span class="line">  GPIO_InitStruct.Mode = GPIO_MODE_INPUT;</span><br><span class="line">  GPIO_InitStruct.Pull = GPIO_PULLUP;</span><br><span class="line">  HAL_GPIO_Init(GPIOE, &amp;GPIO_InitStruct);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*Configure GPIO pin : PtPin */</span></span><br><span class="line">  GPIO_InitStruct.Pin = LED2_Pin;</span><br><span class="line">  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;</span><br><span class="line">  GPIO_InitStruct.Pull = GPIO_NOPULL;</span><br><span class="line">  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;</span><br><span class="line">  HAL_GPIO_Init(LED2_GPIO_Port, &amp;GPIO_InitStruct);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*Configure GPIO pin : PtPin */</span></span><br><span class="line">  GPIO_InitStruct.Pin = SUN_Pin;</span><br><span class="line">  GPIO_InitStruct.Mode = GPIO_MODE_INPUT;</span><br><span class="line">  GPIO_InitStruct.Pull = GPIO_NOPULL;</span><br><span class="line">  HAL_GPIO_Init(SUN_GPIO_Port, &amp;GPIO_InitStruct);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*Configure GPIO pin : PtPin */</span></span><br><span class="line">  GPIO_InitStruct.Pin = LED1_Pin;</span><br><span class="line">  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;</span><br><span class="line">  GPIO_InitStruct.Pull = GPIO_NOPULL;</span><br><span class="line">  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;</span><br><span class="line">  HAL_GPIO_Init(LED1_GPIO_Port, &amp;GPIO_InitStruct);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*Configure GPIO pin : PtPin */</span></span><br><span class="line">  GPIO_InitStruct.Pin = BEEP_Pin;</span><br><span class="line">  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;</span><br><span class="line">  GPIO_InitStruct.Pull = GPIO_PULLUP;</span><br><span class="line">  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;</span><br><span class="line">  HAL_GPIO_Init(BEEP_GPIO_Port, &amp;GPIO_InitStruct);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>main.h</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//60行开始</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Key1_Pin GPIO_PIN_3</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Key1_GPIO_Port GPIOE</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Key2_Pin GPIO_PIN_4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Key2_GPIO_Port GPIOE</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LED2_Pin GPIO_PIN_5</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LED2_GPIO_Port GPIOE</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SUN_Pin GPIO_PIN_11</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SUN_GPIO_Port GPIOB</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LED1_Pin GPIO_PIN_5</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LED1_GPIO_Port GPIOB</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BEEP_Pin GPIO_PIN_8</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BEEP_GPIO_Port GPIOB</span></span><br></pre></td></tr></table></figure><p>若烧录完成后，需要按复位按键才可正常，可尝试以下设置</p><p>第一步：</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022101639.png" alt="设置1" style="zoom:50%;"><p>第二步：</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022101545.png" alt="设置2" style="zoom:50%;">]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;理论说明&quot;&gt;&lt;a href=&quot;#理论说明&quot; class=&quot;headerlink&quot; title=&quot;理论说明&quot;&gt;&lt;/a&gt;&lt;center&gt;理论说明&lt;/center&gt;&lt;/h1&gt;&lt;h2 id=&quot;输入&quot;&gt;&lt;a href=&quot;#输入&quot; class=&quot;headerlink&quot; tit</summary>
      
    
    
    
    <category term="32单片机" scheme="http://example.com/categories/32%E5%8D%95%E7%89%87%E6%9C%BA/"/>
    
    
    <category term="32单片机" scheme="http://example.com/tags/32%E5%8D%95%E7%89%87%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>0.SMT32原理概述</title>
    <link href="http://example.com/post/99cd7d8.html"/>
    <id>http://example.com/post/99cd7d8.html</id>
    <published>2024-08-02T07:41:35.000Z</published>
    <updated>2024-08-10T06:55:45.960Z</updated>
    
    <content type="html"><![CDATA[<h1 id="51和32区别"><a href="#51和32区别" class="headerlink" title="51和32区别"></a><center>51和32区别</center></h1><p>位数：</p><p>&ensp;&ensp;&ensp;&ensp;51：8位（STC89C52）</p><p>&ensp;&ensp;&ensp;&ensp;32：32位（STM32F103ZET6）</p><p>时钟：</p><ul><li>51：11.0592Mhz晶振</li><li>32<ul><li>F103：8Mhz晶振(×9)，主频：72Mhz</li><li>F103：12Mhz晶振(×6)，主频：72Mhz</li><li>F407：168Mhz主频</li></ul></li></ul><h1 id="时钟"><a href="#时钟" class="headerlink" title="时钟"></a><center>时钟</center></h1><p>E：外部，I：内部</p><p>高速外部晶振：HSE</p><p>低速外部晶振：LSE</p><p>高速内部晶振：HSI</p><p>低速内部晶振：LSI</p><p>锁相环：让8MHz晶振变成72MHz主频</p><p>每个外设初始化的大致流程</p><ol><li>把图形化界面配置的参数赋值给对应的结构体的成员变量</li><li>把结构体地址当做参数传给初始化函数</li><li>初始化函数根据每个结构体成员变量操作对应的寄存器</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//时钟初始化</span></span><br><span class="line">SystemClock_Config();</span><br><span class="line"></span><br><span class="line">RCC_OscInitTypeDef RCC_OscInitStruct = &#123;<span class="number">0</span>&#125;;<span class="comment">//结构体类型变量</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//在void SystemClock_Config(void)中(main.c第133)</span></span><br><span class="line">RCC_OscInitStruct.HSEState = RCC_HSE_ON;<span class="comment">//(144行)</span></span><br><span class="line"></span><br><span class="line">HAL_RCC_OscConfig(&amp;RCC_OscInitStruct);<span class="comment">//(main.c第148)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//HAL_StatusTypeDef HAL_RCC_OscConfig(RCC_OscInitTypeDef  *RCC_OscInitStruct)中</span></span><br><span class="line">__HAL_RCC_HSE_CONFIG(RCC_OscInitStruct-&gt;HSEState);<span class="comment">//377行</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __HAL_RCC_HSE_CONFIG(__STATE__)<span class="comment">//__STATE__ = RCC_OscInitStruct-&gt;HSEState(RCC_HSE_ON)           </span></span></span><br><span class="line">   <span class="keyword">do</span>&#123;                                                     </span><br><span class="line">     <span class="keyword">if</span> ((__STATE__) == RCC_HSE_ON)                        </span><br><span class="line">     &#123;                                                     </span><br><span class="line">       SET_BIT(RCC-&gt;CR, RCC_CR_HSEON);<span class="comment">//RCC-&gt;CR = 时钟控制寄存器(RCC_CR)</span></span><br><span class="line">     &#125; </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RCC_CR_HSEON_Pos           (16U)</span></span><br><span class="line"><span class="comment">//0x1左移16位（注意是二进制左移）               </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RCC_CR_HSEON_Msk           (0x1UL &lt;&lt; RCC_CR_HSEON_Pos)   <span class="comment">/*!&lt; 0x00010000 */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RCC_CR_HSEON               RCC_CR_HSEON_Msk</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//第17个数为1，则是第十六位，第16位：0：HSE振荡器关闭，1：HSE振荡器开启。</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SET_BIT(REG, BIT)     ((REG) |= (BIT))<span class="comment">//BIT = RCC_CR_HSEON(0x00010000)</span></span></span><br></pre></td></tr></table></figure><h1 id="STM32芯片参数"><a href="#STM32芯片参数" class="headerlink" title="STM32芯片参数"></a><center>STM32芯片参数</center></h1><p>Core: ARM 32-bit Cortex™-M3 CPU：ARM架构，32位单片机，内核型号</p><p>72 MHz maximum frequency：72MHz主频</p><p>芯片型号含义：</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022046308.png" alt="芯片型号含义" style="zoom:50%;"><p> Flash：磁盘，RAM：运行内存</p><p>一般软件、代码等运行在RAM，但32单片机代码运行在Flash</p><p>3 × 12-bit, 1 µs A&#x2F;D converters</p><ul><li>A&#x2F;D converter &#x3D; ADC：A：模拟信号，D：数字信号，模拟信号转数字信号</li><li>3：3路ADC</li><li>Conversion range: 0 to 3.6 V：采样值 0-3.6V</li><li>12bit：$2^{12} &#x3D; 4096$，将采样范围分成4096份，即为采样精度，这个越高精度越高</li><li>2 × 12-bit D&#x2F;A converters &#x3D; DAC：数字信号转模拟信号</li><li>Serial wire debug (SWD) ：STL烧写</li><li>Up to 112 fast I&#x2F;O ports：112个IO口功能引脚</li><li>Up to 11 timers：11个定时器</li></ul><h1 id="软件安装与使用"><a href="#软件安装与使用" class="headerlink" title="软件安装与使用"></a><center>软件安装与使用</center></h1><p>注意：<code>所有路径不能有中文</code>(包含用户名)</p><p>安装：keil、STM32CubeMX、STM32CubeIDE（需要的留言）</p><p><a href="https://blog.csdn.net/qq_65047384/article/details/140686974">STM32CubeIDE与STM32CubeMX库文件安装路径自定义设置</a></p><p>搜索自己芯片型号（我的型号：<code>STM32F103ZET6</code>）</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022046767.png" alt="便捷技巧" style="zoom:33%;"><h2 id="新建工程必须设置"><a href="#新建工程必须设置" class="headerlink" title="新建工程必须设置"></a><center>新建工程必须设置</center></h2><h3 id="STM32CubeMX"><a href="#STM32CubeMX" class="headerlink" title="STM32CubeMX"></a>STM32CubeMX</h3><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022057113.png" alt="设置1" style="zoom:33%;"><hr><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022057228.png" alt="设置2" style="zoom:33%;"><hr><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022046933.png" alt="时钟配置" style="zoom:33%;"><hr><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022046781.png" alt="工程" style="zoom:33%;"><hr><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022046602.png" alt="工程1" style="zoom:33%;"><hr><p>完成，建工程</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022054262.png" alt="完成" style="zoom: 33%;"><h3 id="STM32CubeIDE"><a href="#STM32CubeIDE" class="headerlink" title="STM32CubeIDE"></a>STM32CubeIDE</h3><p>新建工程</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022046269.png" alt="新建工程" style="zoom: 50%;"><hr><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022046143.png" alt="选型号" style="zoom:33%;"><hr><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022054341.png" alt="工程名" style="zoom:33%;"><hr><p>版本号这里：1.8.5</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022046327.png" alt="完成" style="zoom:33%;"><p>若别人工程为别的版本，需下载别的版本</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022054735.png" alt="下载1" style="zoom:50%;"><p>下载工程对应版本即可</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022046183.png" alt="下载对应版本" style="zoom:33%;"><hr><p>这里与STM32CubeMX相同，参考上面配置，最后：<code>ctrl + s</code> 保存</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022046464.png" alt="在这里插入图片描述" style="zoom: 33%;"><p>Keil+CubeMX &#x3D; CubeIDE</p><h1 id="烧录"><a href="#烧录" class="headerlink" title="烧录"></a><center>烧录</center></h1><p>代码烧录方式</p><h2 id="ST-Link"><a href="#ST-Link" class="headerlink" title="ST-Link"></a><center>ST-Link</center></h2><p>将ST-Link烧写器与单片机连接</p><p><strong>CubeMX keil软件烧录</strong></p><p>编译无错误后，点击图中框选按钮烧录</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022046458.png" alt="烧录按钮" style="zoom:50%;"><p>若烧录不成功，可看是否是这个错误：<a href="https://blog.csdn.net/qq_65047384/article/details/140702048?spm=1001.2014.3001.5501">链接</a></p><p><strong>CubeIDE软件烧录</strong></p><p>编译无错误后，点击图中框选按钮烧录</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022046795.png" alt="烧录介绍" style="zoom:50%;"><h2 id="STM32-ST-LINK-Utility"><a href="#STM32-ST-LINK-Utility" class="headerlink" title="STM32 ST-LINK Utility"></a><center>STM32 ST-LINK Utility</center></h2><p>其实是一个烧写软件，看图可知，对应功能</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022046292.png" alt="介绍" style="zoom:50%;"><p>选择好对应hex文件，直接烧写即可</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022055078.png" alt="烧写界面" style="zoom:50%;"><h2 id="串口烧录"><a href="#串口烧录" class="headerlink" title="串口烧录"></a><center>串口烧录</center></h2><p>步骤：</p><ol><li><p>数据线连接电脑和单片机串口1</p></li><li><p>手动将板子的BOOT0置1，BOOT1置0，使用Bootloader方式</p></li><li><p>断电 重启</p></li><li><p>打开FlyMCU软件烧写（若没有反应可按复位按钮尝试）</p> <img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic/img/202408022046523.png" alt="界面介绍" style="zoom: 50%;"></li><li><p>手动将板子的BOOT0置0，BOOT1置0</p></li><li><p>板子重新上电</p></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;51和32区别&quot;&gt;&lt;a href=&quot;#51和32区别&quot; class=&quot;headerlink&quot; title=&quot;51和32区别&quot;&gt;&lt;/a&gt;&lt;center&gt;51和32区别&lt;/center&gt;&lt;/h1&gt;&lt;p&gt;位数：&lt;/p&gt;
&lt;p&gt;&amp;ensp;&amp;ensp;&amp;ensp;&amp;ens</summary>
      
    
    
    
    <category term="32单片机" scheme="http://example.com/categories/32%E5%8D%95%E7%89%87%E6%9C%BA/"/>
    
    
    <category term="32单片机" scheme="http://example.com/tags/32%E5%8D%95%E7%89%87%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>8.电机控制</title>
    <link href="http://example.com/post/93c966f3.html"/>
    <id>http://example.com/post/93c966f3.html</id>
    <published>2024-08-02T03:01:57.000Z</published>
    <updated>2024-08-10T06:54:22.670Z</updated>
    
    <content type="html"><![CDATA[<h1 id="直流电机"><a href="#直流电机" class="headerlink" title="直流电机"></a><center>直流电机</center></h1><p>原理：<a href="https://www.bilibili.com/video/BV1PM4y1w79m/?t=3.337014&spm_id_from=333.1350.jump_directly&vd_source=1c838941386ee32c4501615c317f75e0">链接</a></p><p>转速：脉冲宽度调制（Pulse width modulation，PWM）</p><p>周期（频率）、占空比</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408031246045.png" alt="电机变速解析图" style="zoom:50%;"><h2 id="电机驱动电路"><a href="#电机驱动电路" class="headerlink" title="电机驱动电路"></a><center>电机驱动电路</center></h2><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408031249504.png" alt="驱动实物图" style="zoom:50%;"><h2 id="代码编写"><a href="#代码编写" class="headerlink" title="代码编写"></a><center>代码编写</center></h2><p>按键控制直流电机速度</p><h3 id="main-c"><a href="#main-c" class="headerlink" title="main.c"></a>main.c</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;main.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;delay.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> count = <span class="number">0</span>,level = <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">TR0 = <span class="number">1</span>;</span><br><span class="line">TH0 = <span class="number">0xDC</span>;</span><br><span class="line">TL0 = <span class="number">0x00</span>;</span><br><span class="line">TMOD = <span class="number">0x01</span>;</span><br><span class="line">ET0 = <span class="number">1</span>;</span><br><span class="line">EA =<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(KEY1 == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">Delay120ms();</span><br><span class="line"><span class="keyword">if</span>(KEY1 == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">level++;</span><br><span class="line">level = level % <span class="number">10</span>;<span class="comment">//到10才清理</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="mian-h"><a href="#mian-h" class="headerlink" title="mian.h"></a>mian.h</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __MAIN_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __MAIN_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg52.h&quot;</span></span></span><br><span class="line"><span class="comment">//定义LED、按键</span></span><br><span class="line">sbit LED1 = P1^<span class="number">0</span>;</span><br><span class="line">sbit KEY1 = P3^<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="type">char</span> count,level;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><h3 id="time-c"><a href="#time-c" class="headerlink" title="time.c"></a>time.c</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;main.h&quot;</span></span></span><br><span class="line"><span class="comment">//定时中断</span></span><br><span class="line">Timer0_Routine(<span class="type">void</span>) interrupt <span class="number">1</span></span><br><span class="line">&#123;</span><br><span class="line">TH0 = <span class="number">0xDC</span>;</span><br><span class="line">TL0 = <span class="number">0x00</span>;</span><br><span class="line">count++;<span class="comment">//每次定时中断加1</span></span><br><span class="line"><span class="keyword">if</span>(count &gt; level)<span class="comment">//level越大，占空比越小速度越慢</span></span><br><span class="line">LED1 = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">LED1 = <span class="number">0</span>;</span><br><span class="line">count = count % <span class="number">10</span>;<span class="comment">//到10清零</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="delay-c"><a href="#delay-c" class="headerlink" title="delay.c"></a>delay.c</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;delay.h&quot;</span></span></span><br><span class="line"><span class="comment">//延时函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Delay120ms</span><span class="params">()</span><span class="comment">//@11.0592MHz</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> data i, j;</span><br><span class="line"></span><br><span class="line">i = <span class="number">216</span>;</span><br><span class="line">j = <span class="number">37</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span> (--j);</span><br><span class="line">&#125; <span class="keyword">while</span> (--i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="delay-h"><a href="#delay-h" class="headerlink" title="delay.h"></a>delay.h</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __DELAY_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __DELAY_H__</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Delay120ms</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>练习：直流电机与iic通信连接oled屏，显示电机转速等级数字</p><h1 id="进步电机"><a href="#进步电机" class="headerlink" title="进步电机"></a><center>进步电机</center></h1><p>原理：<a href="https://www.bilibili.com/video/BV1nA4m1A7Ke/?t=93.445511&spm_id_from=333.1350.jump_directly&vd_source=1c838941386ee32c4501615c317f75e0">链接</a></p><h2 id="代码编写-1"><a href="#代码编写-1" class="headerlink" title="代码编写"></a><center>代码编写</center></h2><h3 id="main-c-1"><a href="#main-c-1" class="headerlink" title="main.c"></a>main.c</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;main.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;delay.h&quot;</span></span></span><br><span class="line"><span class="type">int</span> x,y;</span><br><span class="line">uchar phasecw[<span class="number">4</span>] =&#123;<span class="number">0x08</span>,<span class="number">0x04</span>,<span class="number">0x02</span>,<span class="number">0x01</span>&#125;;<span class="comment">//正向，四相电机对应四相通电</span></span><br><span class="line">uchar phaseccw[<span class="number">4</span>]=&#123;<span class="number">0x01</span>,<span class="number">0x02</span>,<span class="number">0x04</span>,<span class="number">0x08</span>&#125;;<span class="comment">//方向</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(x = <span class="number">0</span>;x &lt; <span class="number">100</span>;x++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(y = <span class="number">0</span>;y &lt; <span class="number">4</span>;y++)<span class="comment">//四相通电转的角度</span></span><br><span class="line">&#123;</span><br><span class="line">P2 = phasecw[y];<span class="comment">//电机连接P2口(低四位)</span></span><br><span class="line">Delay5ms();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="main-h"><a href="#main-h" class="headerlink" title="main.h"></a>main.h</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __MAIN_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __MAIN_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;reg52.h&quot;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">char</span> uchar;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><h3 id="delay-c-1"><a href="#delay-c-1" class="headerlink" title="delay.c"></a>delay.c</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;delay.h&quot;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Delay5ms</span><span class="params">()</span><span class="comment">//@11.0592MHz</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> data i, j;</span><br><span class="line"></span><br><span class="line">i = <span class="number">9</span>;</span><br><span class="line">j = <span class="number">244</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span> (--j);</span><br><span class="line">&#125; <span class="keyword">while</span> (--i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="delay-h-1"><a href="#delay-h-1" class="headerlink" title="delay.h"></a>delay.h</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __DELAY_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __DELAY_H__</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Delay5ms</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>练习：OLED屏显示步进电机前进还是后退(前进1，后退0)，按键控制步进电机前进还是后退</p><h1 id="舵机控制"><a href="#舵机控制" class="headerlink" title="舵机控制"></a><center>舵机控制</center></h1><p>角度：180&#x2F;360度（这里舵机180度）</p><p>模型图：</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408031246245.png" alt="展示接线图" style="zoom:50%;"><p>信号说明：</p><p>舵机脉冲周期：20ms</p><img src="https://cdn.d3iiz.top/gh/xinzai-x/MyPic1/img/202408031246721.png" alt="信号使用说明" style="zoom:33%;"><h2 id="代码编写-2"><a href="#代码编写-2" class="headerlink" title="代码编写"></a><center>代码编写</center></h2><p>舵机180度控制旋转</p><h3 id="main-c-2"><a href="#main-c-2" class="headerlink" title="main.c"></a>main.c</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;main.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;delay.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> level = <span class="number">0</span>,count = <span class="number">0</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">TR0 = <span class="number">1</span>;</span><br><span class="line"><span class="comment">//定时器时间：0.5ms</span></span><br><span class="line">TMOD |= <span class="number">0x01</span>;</span><br><span class="line">TL0 = <span class="number">0x33</span>;</span><br><span class="line">TH0 = <span class="number">0xFE</span>;</span><br><span class="line">ET0 = <span class="number">1</span>;</span><br><span class="line">EA = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(KEY1 == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">Delay120ms();</span><br><span class="line"><span class="keyword">if</span>(KEY1 == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">level++;</span><br><span class="line">level = level % <span class="number">6</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Timer0_Routine(<span class="type">void</span>) interrupt <span class="number">1</span></span><br><span class="line">&#123;</span><br><span class="line">TL0 = <span class="number">0x33</span>;</span><br><span class="line">TH0 = <span class="number">0xFE</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">level为1时，脉冲为1，持续时间0.5ms，转动角度为0，但按键延迟120ms，早过一个周期，</span></span><br><span class="line"><span class="comment">则下次按键时count为0，则持续时间为1ms，转动角度为45，以此类推，下次转动90，</span></span><br><span class="line"><span class="comment">但上一次已经转了45，所以实际再转45就到90度，当到达180度时，level为1时，转动0度，</span></span><br><span class="line"><span class="comment">相当于回到原点</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">if</span>(count &lt; level)</span><br><span class="line">SG90_PWM = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">SG90_PWM = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">count++;</span><br><span class="line"><span class="comment">//周期20ms，0.5ms一次定时中断触发，40次则20ms</span></span><br><span class="line"><span class="keyword">if</span>(count &gt; <span class="number">40</span>)</span><br><span class="line">count = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="main-h-1"><a href="#main-h-1" class="headerlink" title="main.h"></a>main.h</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __MAIN_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __MAIN_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;reg52.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">sbit SG90_PWM = P2^<span class="number">0</span>;</span><br><span class="line">sbit KEY1 = P3^<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><h3 id="delay-c-2"><a href="#delay-c-2" class="headerlink" title="delay.c"></a>delay.c</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;delay.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Delay120ms</span><span class="params">()</span><span class="comment">//@11.0592MHz</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> data i, j;</span><br><span class="line"></span><br><span class="line">i = <span class="number">216</span>;</span><br><span class="line">j = <span class="number">37</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span> (--j);</span><br><span class="line">&#125; <span class="keyword">while</span> (--i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="delay-h-2"><a href="#delay-h-2" class="headerlink" title="delay.h"></a>delay.h</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __DELAY_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __DELAY_H__</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Delay120ms</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>练习：OLED屏显示数字代表舵机旋转角度，按键控制舵机角度</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;直流电机&quot;&gt;&lt;a href=&quot;#直流电机&quot; class=&quot;headerlink&quot; title=&quot;直流电机&quot;&gt;&lt;/a&gt;&lt;center&gt;直流电机&lt;/center&gt;&lt;/h1&gt;&lt;p&gt;原理：&lt;a href=&quot;https://www.bilibili.com/video/BV</summary>
      
    
    
    
    <category term="51单片机" scheme="http://example.com/categories/51%E5%8D%95%E7%89%87%E6%9C%BA/"/>
    
    
    <category term="51单片机" scheme="http://example.com/tags/51%E5%8D%95%E7%89%87%E6%9C%BA/"/>
    
  </entry>
  
</feed>
